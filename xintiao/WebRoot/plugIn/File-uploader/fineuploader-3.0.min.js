var qq=qq||{};var qq=function(a){return{hide:function(){a.style.display="none";return this},attach:function(c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}return function(){qq(a).detach(c,b)}},detach:function(c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}return this},contains:function(b){if(a==b){return true}if(a.contains){return a.contains(b)}else{return !!(b.compareDocumentPosition(a)&8)}},insertBefore:function(b){b.parentNode.insertBefore(a,b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b);return this},hasClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},addClass:function(b){if(!qq(a).hasClass(b)){a.className+=" "+b}return this},removeClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(c){if(a.querySelectorAll){return a.querySelectorAll("."+c)}var f=[];var b=a.getElementsByTagName("*");var e=b.length;for(var d=0;d<e;d++){if(qq(b[d]).hasClass(c)){f.push(b[d])}}return f},children:function(){var c=[],b=a.firstChild;while(b){if(b.nodeType==1){c.push(b)}b=b.nextSibling}return c},setText:function(b){a.innerText=b;a.textContent=b;return this},clearText:function(){return qq(a).setText("")}}};qq.log=function(b,a){return;if(window.console){if(!a||a==="info"){window.console.log(b)}else{if(window.console[a]){window.console[a](b)}else{window.console.log("<"+a+"> "+b)}}}};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.extend=function(b,d,a){var c;for(c in d){if(d.hasOwnProperty(c)){if(a&&qq.isObject(d[c])){if(b[c]===undefined){b[c]={}}qq.extend(b[c],d[c],true)}else{b[c]=d[c]}}}};qq.indexOf=function(a,b,c){if(a.indexOf){return a.indexOf(b,c)}c=c||0;var d=a.length;if(c<0){c+=d}for(;c<d;c++){if(c in a&&a[c]===b){return c}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!=-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!=-1};qq.safari=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf("Apple")!=-1};qq.chrome=function(){return navigator.vendor!=undefined&&navigator.vendor.indexOf("Google")!=-1};qq.firefox=function(){return(navigator.userAgent.indexOf("Mozilla")!=-1&&navigator.vendor!=undefined&&navigator.vendor=="")};qq.windows=function(){return navigator.platform=="Win32"};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.obj2url=function(d,g,f){var h=[],e="&",a=function(k,j){var l=g?(/\[\]$/.test(g))?g:g+"["+j+"]":j;if((l!="undefined")&&(j!="undefined")){h.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!f&&g){e=(/\?/.test(g))?(/\?$/.test(g))?"":"&":"?";h.push(g);h.push(qq.obj2url(d))}else{if((Object.prototype.toString.call(d)==="[object Array]")&&(typeof d!="undefined")){for(var b=0,c=d.length;b<c;++b){a(d[b],b)}}else{if((typeof d!="undefined")&&(d!==null)&&(typeof d==="object")){for(var b in d){a(d[b],b)}}else{h.push(encodeURIComponent(g)+"="+encodeURIComponent(d))}}}if(g){return h.join(e)}else{return h.join(e).replace(/^&/,"").replace(/%20/g,"+")}};qq.DisposeSupport={_disposers:[],dispose:function(){var a;while(a=this._disposers.shift()){a()}},addDisposer:function(a){this._disposers.push(a)},_attach:function(){this.addDisposer(qq(arguments[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;qq(this._element).css({position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq(this._input).remove()}qq(this._element).removeClass(this._options.focusClass);this._input=this._createInput()},_createInput:function(){var a=document.createElement("input");if(this._options.multiple){a.setAttribute("multiple","multiple")}if(this._options.acceptFiles){a.setAttribute("accept",this._options.acceptFiles)}a.setAttribute("type","file");a.setAttribute("name",this._options.name);qq(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});this._element.appendChild(a);var b=this;this._attach(a,"change",function(){b._options.onChange(a)});this._attach(a,"mouseover",function(){qq(b._element).addClass(b._options.hoverClass)});this._attach(a,"mouseout",function(){qq(b._element).removeClass(b._options.hoverClass)});this._attach(a,"focus",function(){qq(b._element).addClass(b._options.focusClass)});this._attach(a,"blur",function(){qq(b._element).removeClass(b._options.focusClass)});if(window.attachEvent){a.setAttribute("tabIndex","-1")}return a}};qq.FineUploaderBasic=function(a){var b=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:true,autoUpload:true,request:{endpoint:"/server/upload",params:{},customHeaders:{},forceMultipart:false,inputName:"qqfile"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,stopOnFirstInvalidFile:true},callbacks:{onSubmit:function(d,c){},onComplete:function(d,c,e){},onCancel:function(d,c){},onUpload:function(d,c,e){},onProgress:function(d,c,e,f){},onError:function(d,c,e){},onAutoRetry:function(e,d,c){},onManualRetry:function(d,c){},onValidate:function(c){}},messages:{typeError:"{file} 上传文件类型不符: {extensions}",sizeError:"{file} 上传文件过大,最大为： {sizeLimit}",minSizeError:"{file} 上传文件过小，最小为： {minSizeLimit}",emptyError:"{file} 上传文件为空，请选择最少一个文件",noFilesError:"没有上传文件",onLeave:"文件正在上传,如果你现在离开上传将会取消"},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"}};qq.extend(this._options,a,true);this._wrapCallbacks();qq.extend(this,qq.DisposeSupport);this._filesInProgress=0;this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(b,a){if(this._options.debug&&(!a||a==="info")){qq.log("[FineUploader] "+b)}else{if(a&&a!=="info"){qq.log("[FineUploader] "+b,a)}}},setParams:function(a){this._options.request.params=a},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){while(this._storedFileIds.length){this._filesInProgress++;this._handler.upload(this._storedFileIds.shift(),this._options.request.params)}},clearStoredFiles:function(){this._storedFileIds=[]},retry:function(a){if(this._onBeforeManualRetry(a)){this._handler.retry(a);return true}else{return false}},cancel:function(a){this._handler.cancel(a)},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=0;this._storedFileIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset()},_createUploadButton:function(b){var c=this;var a=new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(d){c._onInputChange(d)}});this.addDisposer(function(){a.dispose()});return a},_createUploadHandler:function(){var c=this,b;if(qq.UploadHandlerXhr.isSupported()){b="UploadHandlerXhr"}else{b="UploadHandlerForm"}var a=new qq[b]({debug:this._options.debug,endpoint:this._options.request.endpoint,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,demoMode:this._options.demoMode,log:this.log,onProgress:function(e,d,f,g){c._onProgress(e,d,f,g);c._options.callbacks.onProgress(e,d,f,g)},onComplete:function(e,d,f,g){c._onComplete(e,d,f,g);c._options.callbacks.onComplete(e,d,f)},onCancel:function(e,d){c._onCancel(e,d);c._options.callbacks.onCancel(e,d)},onUpload:function(e,d,f){c._onUpload(e,d,f);c._options.callbacks.onUpload(e,d,f)},onAutoRetry:function(e,d,f,g){c._preventRetries[e]=f[c._options.retry.preventRetryResponseProperty];if(c._shouldAutoRetry(e,d,f)){c._maybeParseAndSendUploadError(e,d,f,g);c._options.callbacks.onAutoRetry(e,d,c._autoRetries[e]+1);c._onBeforeAutoRetry(e,d);c._retryTimeouts[e]=setTimeout(function(){c._onAutoRetry(e,d,f)},c._options.retry.autoAttemptDelay*1000);return true}else{return false}}});return a},_preventLeaveInProgress:function(){var a=this;this._attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){if(this._options.autoUpload){this._filesInProgress++}},_onProgress:function(b,a,c,d){},_onComplete:function(b,a,c,d){this._filesInProgress--;this._maybeParseAndSendUploadError(b,a,c,d)},_onCancel:function(b,a){clearTimeout(this._retryTimeouts[b]);var c=qq.indexOf(this._storedFileIds,b);if(this._options.autoUpload||c<0){this._filesInProgress--}else{if(!this._options.autoUpload){this._storedFileIds.splice(c,1)}}},_onUpload:function(b,a,c){},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_onBeforeAutoRetry:function(b,a){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+a+"...")},_onAutoRetry:function(b,a,c){this.log("Retrying "+a+"...");this._autoRetries[b]++;this._handler.retry(b)},_shouldAutoRetry:function(b,a,c){if(!this._preventRetries[b]&&this._options.retry.enableAuto){if(this._autoRetries[b]===undefined){this._autoRetries[b]=0}return this._autoRetries[b]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(b){if(this._preventRetries[b]){this.log("Retries are forbidden for id "+b,"warn");return false}else{if(this._handler.isValid(b)){var a=this._handler.getName(b);if(this._options.callbacks.onManualRetry(b,a)===false){return false}this.log("Retrying upload for '"+a+"' (id: "+b+")...");this._filesInProgress++;return true}else{this.log("'"+b+"' is not a valid file ID","error");return false}}},_maybeParseAndSendUploadError:function(c,b,d,e){if(!d.success){if(e&&e.status!==200&&!d.error){this._options.callbacks.onError(c,b,"XHR returned response code "+e.status)}else{var a=d.error?d.error:"Upload failure reason unknown";this._options.callbacks.onError(c,b,a)}}},_uploadFileList:function(b){var d,c,a;d=this._getValidationDescriptors(b);if(d.length>1){a=this._options.callbacks.onValidate(d)===false}if(!a){if(b.length>0){for(c=0;c<b.length;c++){if(this._validateFile(b[c])){this._uploadFile(b[c])}else{if(this._options.validation.stopOnFirstInvalidFile){return}}}}else{this._error("noFilesError","")}}},_uploadFile:function(a){var c=this._handler.add(a);var b=this._handler.getName(c);if(this._options.callbacks.onSubmit(c,b)!==false){this._onSubmit(c,b);if(this._options.autoUpload){this._handler.upload(c,this._options.request.params)}else{this._storeFileForLater(c)}}},_storeFileForLater:function(a){this._storedFileIds.push(a)},_validateFile:function(a){var d,b,c;d=this._getValidationDescriptor(a);b=d.name;c=d.size;if(this._options.callbacks.onValidate([d])===false){return false}if(!this._isAllowedExtension(b)){this._error("typeError",b);return false}else{if(c===0){this._error("emptyError",b);return false}else{if(c&&this._options.validation.sizeLimit&&c>this._options.validation.sizeLimit){this._error("sizeError",b);return false}else{if(c&&c<this._options.validation.minSizeLimit){this._error("minSizeError",b);return false}}}}return true},_error:function(a,c){var d=this._options.messages[a];function e(f,g){d=d.replace(f,g)}var b=this._options.validation.allowedExtensions.join(", ");e("{file}",this._formatFileName(c));e("{extensions}",b);e("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit));e("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit));this._options.callbacks.onError(null,c,d);return d},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(c){var b=(-1!==c.indexOf("."))?c.replace(/.*[.]/,"").toLowerCase():"";var a=this._options.validation.allowedExtensions;if(!a.length){return true}for(var d=0;d<a.length;d++){if(a[d].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]},_wrapCallbacks:function(){var c,b;c=this;b=function(g,e,d){try{return e.apply(c,d)}catch(f){c.log("Caught exception in '"+g+"' callback - "+f,"error")}};for(var a in this._options.callbacks){(function(){var d=c._options.callbacks[a];c._options.callbacks[a]=function(){return b(a,d,arguments)}}())}},_parseFileName:function(a){var b;if(a.value){b=a.value.replace(/.*(\/|\\)/,"")}else{b=(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name}return b},_parseFileSize:function(a){var b;if(!a.value){b=(a.fileSize!==null&&a.fileSize!==undefined)?a.fileSize:a.size}return b},_getValidationDescriptor:function(a){var c,d,b;b={};c=this._parseFileName(a);d=this._parseFileSize(a);b.name=c;if(d){b.size=d}return b},_getValidationDescriptors:function(b){var c,a;a=[];for(c=0;c<b.length;c++){a.push(b[c])}return a}};qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},text:{uploadButton:"浏览...",cancelButton:"[删除]",retryButton:"Retry",failUpload:"Upload failed",dragZone:"Drop files here to upload",formatProgress:"{percent}% of {total_size}",waitingForResponse:"正在上传..."},template:'<div class="qq-uploader">'+((!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone)?'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>':"")+(!this._options.button?'<div class="qq-upload-button btn "><div>{uploadButtonText}</div></div>':"")+(!this._options.autoUpload?'<div class="qq-doupload-button btn" style="margin-left: 5px;" >上传</div>':"")+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':"")+"</div>",fileTemplate:'<li  ><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span><span class="qq-upload-file"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">{cancelButtonText}</a><div  class="qq-progress-bar-box" ><span class="qq-progress-bar"  ></span></div></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},showMessage:function(b){alert(b)}},true);qq.extend(this._options,a,true);this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._setupDragDrop()};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(a){this._setupExtraDropzone(a)},removeExtraDropzone:function(b){var a=this._options.dragAndDrop.extraDropzones;for(var c in a){if(a[c]===b){return this._options.dragAndDrop.extraDropzones.splice(c,1)}}},getItemByFileId:function(a){var b=this._listElement.firstChild;while(b){if(b.qqFileId==a){return b}b=b.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");if(!this._options.button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._setupDragDrop()},_leaving_document_out:function(a){return((qq.chrome()||(qq.safari()&&qq.windows()))&&a.clientX==0&&a.clientY==0)||(qq.firefox()&&!a.relatedTarget)},_storeFileForLater:function(a){qq.FineUploaderBasic.prototype._storeFileForLater.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"spinner")).hide()},_find:function(b,c){var a=qq(b).getByClass(this._options.classes[c])[0];if(!a){throw new Error("element not found "+c)}return a},_setupExtraDropzone:function(a){this._options.dragAndDrop.extraDropzones.push(a);this._setupDropzone(a)},_setupDropzone:function(a){var c=this;var b=new qq.UploadDropZone({element:a,onEnter:function(d){qq(a).addClass(c._classes.dropActive);d.stopPropagation()},onLeave:function(d){},onLeaveNotDescendants:function(d){qq(a).removeClass(c._classes.dropActive)},onDrop:function(d){if(c._options.dragAndDrop.hideDropzones){qq(a).hide()}qq(a).removeClass(c._classes.dropActive);if(d.dataTransfer.files.length>1&&!c._options.multiple){c._error("tooManyFilesError","")}else{c._uploadFileList(d.dataTransfer.files)}}});this.addDisposer(function(){b.dispose()});if(this._options.dragAndDrop.hideDropzones){qq(a).hide()}},_setupDragDrop:function(){var d,a;d=this;if(!this._options.dragAndDrop.disableDefaultDropzone){a=this._find(this._element,"drop");this._options.dragAndDrop.extraDropzones.push(a)}var b=this._options.dragAndDrop.extraDropzones;var c;for(c=0;c<b.length;c++){this._setupDropzone(b[c])}if(!this._options.dragAndDrop.disableDefaultDropzone&&(!qq.ie()||qq.ie10())){this._attach(document,"dragenter",function(f){if(qq(a).hasClass(d._classes.dropDisabled)){return}a.style.display="block";for(c=0;c<b.length;c++){b[c].style.display="block"}})}this._attach(document,"dragleave",function(f){if(d._options.dragAndDrop.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(f)){for(c=0;c<b.length;c++){qq(b[c]).hide()}}});qq(document).attach("drop",function(f){if(d._options.dragAndDrop.hideDropzones){for(c=0;c<b.length;c++){qq(b[c]).hide()}}f.preventDefault()})},_onSubmit:function(b,a){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(c,b,e,j){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var d,g,i,f,a,h;d=this.getItemByFileId(c);g=this._find(d,"progressBar");f=Math.round(e/j*100);if(e===j){a=this._find(d,"cancel");qq(a).hide();i=this._formatSize(j)}else{i=this._formatProgress(e,j);qq(g).css({display:"block"})}qq(g).css({width:f+"%"});h=this._find(d,"size");qq(h).css({display:"inline"});qq(h).setText(i)},_onComplete:function(b,a,d,e){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var c=this.getItemByFileId(b);qq(c).removeClass(this._classes.retrying);if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported()){qq(this._find(c,"cancel")).hide()}qq(this._find(c,"spinner")).hide();if(d.success){qq(c).addClass(this._classes.success);if(this._classes.successIcon){this._find(c,"finished").style.display="inline-block";qq(c).addClass(this._classes.successIcon)}}else{qq(c).addClass(this._classes.fail);if(this._classes.failIcon){this._find(c,"finished").style.display="inline-block";qq(c).addClass(this._classes.failIcon)}if(this._options.retry.showButton&&!this._preventRetries[b]){qq(c).addClass(this._classes.retryable)}this._controlFailureTextDisplay(c,d)}},_onUpload:function(b,a,d){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);var c=this.getItemByFileId(b);this._showSpinner(c)},_onBeforeAutoRetry:function(c){var d,f,a,b,h,e,g;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);d=this.getItemByFileId(c);f=this._find(d,"progressBar");this._showCancelLink(d);f.style.width=0;if(this._options.retry.showAutoRetryNote){h=this._autoRetries[c]+1;e=this._options.retry.maxAutoAttempts;g=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,h);g=g.replace(/\{maxAuto\}/g,e);qq(b).setText(g);if(h===1){qq(d).addClass(this._classes.retrying)}}},_onBeforeManualRetry:function(a){if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){var b=this.getItemByFileId(a);this._find(b,"progressBar").style.width=0;qq(b).removeClass(this._classes.fail);this._showSpinner(b);this._showCancelLink(b);return true}return false},_addToList:function(d,c){var e=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.UploadHandlerXhr.isSupported()){var a=this._find(e,"cancel");qq(a).remove()}e.qqFileId=d;var b=this._find(e,"file");qq(b).setText(this._formatFileName(c));qq(this._find(e,"size")).hide();if(!this._options.multiple){this._clearList()}this._listElement.appendChild(e)},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_bindCancelAndRetryEvents:function(){var b=this,a=this._listElement;this._attach(a,"click",function(c){c=c||window.event;var f=c.target||c.srcElement;if(qq(f).hasClass(b._classes.cancel)||qq(f).hasClass(b._classes.retry)){qq.preventDefault(c);var d=f.parentNode;while(d.qqFileId==undefined){d=f=f.parentNode}if(qq(f).hasClass(b._classes.cancel)){b.cancel(d.qqFileId);qq(d).remove()}else{qq(d).removeClass(b._classes.retryable);b.retry(d.qqFileId)}}})},_formatProgress:function(d,c){var a=this._options.text.formatProgress;function b(e,f){a=a.replace(e,f)}b("{percent}",Math.round(d/c*100));b("{total_size}",this._formatSize(c));return a},_controlFailureTextDisplay:function(b,e){var d,c,f,a,g;d=this._options.failedUploadTextDisplay.mode;c=this._options.failedUploadTextDisplay.maxChars;f=this._options.failedUploadTextDisplay.responseProperty;if(d==="custom"){a=e[f];if(a){if(a.length>c){g=a.substring(0,c)+"..."}}else{a=this._options.text.failUpload;this.log("'"+f+"' is not a valid property on the server response.","warn")}if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(b,a)}}else{if(d==="default"){}else{if(d!=="none"){this.log("failedUploadTextDisplay.mode value of '"+d+"' is not valid","warn")}}}},_showTooltip:function(a,b){a.title=b},_showSpinner:function(a){var b=this._find(a,"spinner");b.style.display="inline-block"},_showCancelLink:function(b){if(!this._options.disableCancelForFormUploads||qq.UploadHandlerXhr.isSupported()){var a=this._find(b,"cancel");a.style.display="inline"}},_error:function(a,b){var c=qq.FineUploaderBasic.prototype._error.apply(this,arguments);this._options.showMessage(c)}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);qq.extend(this,qq.DisposeSupport);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_dragover_should_be_canceled:function(){return qq.safari()||(qq.firefox()&&qq.windows())},_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){if(this._dragover_should_be_canceled){qq(document).attach("dragover",function(b){b.preventDefault()})}else{qq(document).attach("dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}})}qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;a._attach(a._element,"dragover",function(b){if(!a._isValidFileDrag(b)){return}var c=qq.ie()?null:b.dataTransfer.effectAllowed;if(c=="move"||c=="linkMove"){b.dataTransfer.dropEffect="move"}else{b.dataTransfer.dropEffect="copy"}b.stopPropagation();b.preventDefault()});a._attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});a._attach(a._element,"dragleave",function(b){if(!a._isValidFileDrag(b)){return}a._options.onLeave(b);var c=document.elementFromPoint(b.clientX,b.clientY);if(qq(this).contains(c)){return}a._options.onLeaveNotDescendants(b)});a._attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(b){if(qq.ie()&&!qq.ie10()){return false}var a=b.dataTransfer,d=qq.safari();var c=qq.ie10()?true:a.effectAllowed!="none";return a&&c&&(a.files||(!d&&a.types.contains&&a.types.contains("Files")))}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,endpoint:"/upload.php",maxConnections:999,log:function(c,b){},onProgress:function(c,b,d,e){},onComplete:function(c,b,d,e){},onCancel:function(c,b){},onUpload:function(c,b,d){},onAutoRetry:function(c,b,d,e){}};qq.extend(this._options,a);this._queue=[];this._params=[];this.log=this._options.log};qq.UploadHandlerAbstract.prototype={add:function(a){},upload:function(b,d){var c=this._queue.push(b);var a={};qq.extend(a,d);this._params[b]=a;if(c<=this._options.maxConnections){this._upload(b,this._params[b])}},retry:function(b){var a=qq.indexOf(this._queue,b);if(a>=0){this._upload(b,this._params[b])}else{this.upload(b,this._params[b])}},cancel:function(a){this.log("Cancelling "+a);this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},reset:function(){this.log("Resetting upload handler");this._queue=[];this._params=[]},_upload:function(a){},_cancel:function(a){},_dequeue:function(b){var a=qq.indexOf(this._queue,b);this._queue.splice(a,1);var c=this._options.maxConnections;if(this._queue.length>=c&&a<c){var d=this._queue[c-1];this._upload(d,this._params[d])}},isValid:function(a){}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={};this._detach_load_events={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name",this._options.inputName);var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq(a).remove()}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},isValid:function(a){return this._inputs[a]!==undefined},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments);this._inputs={};this._detach_load_events={}},_cancel:function(a){this._options.onCancel(a,this.getName(a));delete this._inputs[a];delete this._detach_load_events[a];var b=document.getElementById(a);if(b){b.setAttribute("src","javascript:false;");qq(b).remove()}},_upload:function(c,f){this._options.onUpload(c,this.getName(c),false);var e=this._inputs[c];if(!e){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var a=this.getName(c);f[this._options.inputName]=a;var d=this._createIframe(c);var b=this._createForm(d,f);b.appendChild(e);var g=this;this._attachLoadEvent(d,function(){g.log("iframe loaded");var h=g._getIframeContentJSON(d);setTimeout(function(){g._detach_load_events[c]();delete g._detach_load_events[c];qq(d).remove()},1);if(!h.success){if(g._options.onAutoRetry(c,a,h)){return}}g._options.onComplete(c,a,h);g._dequeue(c)});this.log("Sending upload request for "+c);b.submit();qq(b).remove();return c},_attachLoadEvent:function(b,a){var c=this;this._detach_load_events[b.id]=qq(b).attach("load",function(){c.log("Received response for "+b.id);if(!b.parentNode){return}try{if(b.contentDocument&&b.contentDocument.body&&b.contentDocument.body.innerHTML=="false"){return}}catch(d){c.log("Error when attempting to access iframe during handling of upload response ("+d+")","error")}a()})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;var innerHTML=doc.body.innerHTML;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+innerHTML);if(innerHTML&&innerHTML.match(/^<pre/i)){innerHTML=doc.body.firstChild.firstChild.nodeValue}response=eval("("+innerHTML+")")}catch(error){this.log("Error when attempting to parse form upload response ("+error+")","error");response={success:false}}return response},_createIframe:function(a){var b=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');b.setAttribute("id",a);b.style.display="none";document.body.appendChild(b);return b},_createForm:function(b,c){var d=this._options.demoMode?"GET":"POST";var a=qq.toElement('<form method="'+d+'" enctype="multipart/form-data"></form>');var e=qq.obj2url(c,this._options.endpoint);a.setAttribute("action",e);a.setAttribute("target",b.name);a.style.display="none";document.body.appendChild(a);return a}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return("multiple" in a&&typeof File!="undefined"&&typeof FormData!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined")};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return(a.fileName!==null&&a.fileName!==undefined)?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},isValid:function(a){return this._files[a]!==undefined},reset:function(){qq.UploadHandlerAbstract.prototype.reset.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]},_upload:function(c,e){this._options.onUpload(c,this.getName(c),true);var a=this._files[c],d=this.getName(c),i=this.getSize(c);this._loaded[c]=0;var j=this._xhrs[c]=new XMLHttpRequest();var h=this;j.upload.onprogress=function(k){if(k.lengthComputable){h._loaded[c]=k.loaded;h._options.onProgress(c,d,k.loaded,k.total)}};j.onreadystatechange=function(){if(j.readyState==4){h._onComplete(c,j)}};e=e||{};e[this._options.inputName]=d;var g=qq.obj2url(e,this._options.endpoint);var f=this._options.demoMode?"GET":"POST";j.open(f,g,true);j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.setRequestHeader("X-File-Name",encodeURIComponent(d));j.setRequestHeader("Cache-Control","no-cache");if(this._options.forceMultipart){var b=new FormData();b.append(this._options.inputName,a);a=b}else{j.setRequestHeader("Content-Type","application/octet-stream");j.setRequestHeader("X-Mime-Type",a.type)}for(key in this._options.customHeaders){j.setRequestHeader(key,this._options.customHeaders[key])}this.log("Sending upload request for "+c);j.send(a)},_onComplete:function(id,xhr){if(!this._files[id]){return}var name=this.getName(id);var size=this.getSize(id);var response;this._options.onProgress(id,name,size,size);this.log("xhr - server response received for "+id);this.log("responseText = "+xhr.responseText);try{response=eval("("+xhr.responseText+")")}catch(error){this.log("Error when attempting to parse xhr response text ("+error+")","error");response={}}if(xhr.status!==200||!response.success){if(this._options.onAutoRetry(id,name,response,xhr)){return}}this._options.onComplete(id,name,response,xhr);this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});