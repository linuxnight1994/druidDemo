/*
 * 自动完成控件
 * 创建人：qinnailin
 * 创建时间：2014/8/1
 *
 *
 * 
 */
(function(a){a.fn.autoComplete=function(g){var f=a.extend({url:"",data:null,source:"",value:null,key:"id",text:"name",maxSize:10,width:"auto",change:function(h){},offset:null},g||{});var d=a(this);var b;var e;a(d).parent().append('<ul class="typeahead dropdown-menu"></ul>');a(this).attr("autocomplete","off");if(f.width=="auto"){a(".dropdown-menu").width(a(d).width())}else{if(!isNaN(f.width)){a(".dropdown-menu").width(f.width)}}if(f.offset!=null){a(d).next(".dropdown-menu").css({top:f.offset.Top+"px",left:f.offset.Left+"px"})}a(d).keyup(function(){var i=a(d).val();if(i==""){if(f.value){a("input[name="+f.value+"]").val("")}a(d).siblings("ul:first").hide();a(d).siblings("ul:first li").remove();e="";return}if(e!=i){e=i}else{return false}if(f.data){var h=new Array();a.each(f.data,function(k,l){if(l[f.text].indexOf(i)>-1){h.push(l)}});b=h;c(h)}else{if(f.url!=""){var j="{"+a(d).attr("name")+":'"+i+"',maxSize:"+f.maxSize+"}";a.get(f.url,stringToJSON(j),function(k){b=k;if(f.source!=""){var m=k;var l=f.source.split(".");a.each(l,function(o,p){if(p!=""){m=m[p]}});b=m}c(b)})}}});function c(h){if(h&&h.length>0){var j="";var m="<li style='display:inline'><a data-id='{{"+f.key+"}}' href='javascript:' >{{"+f.text+"}}</a></li>";for(var k=0;k<h.length&&k<10;k++){var l=h[k];j+=m.fill(l)}a(d).siblings("ul:first").html(j).show()}}a(document).ready(function(){a(".dropdown").on("click","ul li a",function(){var k=a(this).text();var j=a(this).attr("data-id");a(d).val(k);if(f.value){a("input[name="+f.value+"]").val(j)}a(d).siblings("ul:first").hide();a(d).focus();var l;for(var h=0;h<b.length;h++){if(b[h][f.key]==j){l=b[h];break}}e="";f.change(l)});a(".dropdown").on("mousemove","ul",function(){if(a(".dropdown").find(".active").get(0)){a(".dropdown").find(".active").removeClass("active")}});a(d).keyup(function(h){if(event.keyCode==40){if(a(".dropdown").find(".active").get(0)){a(".dropdown").find(".active").removeClass("active").next("li").addClass("active");if(!a(".dropdown").find(".active").get(0)){a(".dropdown").find("li:first").addClass("active")}}else{a(".dropdown").find("li:first").addClass("active")}}else{if(event.keyCode==38){if(a(".dropdown").find(".active").get(0)){a(".dropdown").find(".active").removeClass("active").prev("li").addClass("active");if(!a(".dropdown").find(".active").get(0)){a(".dropdown").find("li:last").addClass("active")}}else{a(".dropdown").find("li:last").addClass("active")}}else{if(event.keyCode==13){var o;var m;if(a(".dropdown").find(".active").get(0)){m=a(".dropdown").find(".active>a").eq(0)}else{m=a(".dropdown").find("li:first>a")}var l=a(m).text();var k=a(m).attr("data-id");a(d).val(l);if(f.value){a("input[name="+f.value+"]").val(k)}a(d).siblings("ul:first").hide();a(d).focus();for(var j=0;j<b.length;j++){if(b[j][f.key]==k){o=b[j];break}}e="";f.change(o)}}}})})}})(jQuery);
/*
 * 基础类
 * 创建人：qinnailin
 * 创建时间：2014/7/16 
 *
 *
 * 
 */
var isparent=false;if(top.location==self.location){isparent=true}if("addEventListener" in document){window.addEventListener("message",function(e){var func=e.data;if(func&&func!=""){window.eval(func)}},false)}else{if("attachEvent" in document){window.attachEvent("onmessage",function(e){var func=e.data;if(func&&func!=""){window.eval(func)}})}}function crossdomain(a,c){if(c!=null){var b=typeof(c);if(b=="string"&&c!=""){c="'"+c+"'"}else{c=c+""}}else{c=""}window.parent.postMessage(""+a+"("+c+")","*")}$(document).ready(function(){$(document).ajaxStart(function(){try{if(loading&&!document.getElementById("show-middle-modal-content")){loading(true)}}catch(e){}});$(document).ajaxError(function(){try{if(loading){errormsg("服务器发生错误！！")}}catch(e){}});$(document).ajaxSuccess(function(e,req,s){if(s.dataTypes&&s.dataTypes.length>0&&s.dataTypes[1]=="json"){var data=eval("("+req.responseText+")");if(data.login==true||data.login==""){if(parent.window){parent.window.location.reload()}else{window.location.reload()}return false}if(data.utrymsg&&data.utrymsg!=""){alertui(data.utrymsg)}}try{if(loading){setTimeout("loading(false)",500)}}catch(e){}});$(window).resize(function(){setLayout()});setLayout()});function resertLayout(){if($(".main-box").get(0)){var d=getborder($("body"));var a=parseFloat($(window).height())-parseFloat(d);var c=$(".main-box").eq(0);if($(".main-box").eq(0).height()!=(a-getborder(c))){setLayout()}}if(parseInt($.browser.version)<8){for(var b=0;b<12;b++){if(parseFloat($(".span"+b).width())>0){$(".span"+b).width(parseFloat($(".span"+b).width()-1))}}setLayout()}}function setLayout(){if($(".main-box").get(0)){var c=getborder($("body"));var a=parseFloat($(window).height())-parseFloat(c);var b=$(".main-box").eq(0);$(".main-box").eq(0).height(a-getborder(b))}if($(".layout-box").get(0)){$(".layout-box").each(function(e,f){if($(f).find(".layout-center").get(0)){var d=$(f).find(".layout-center").eq(0);findlayout(d)}})}}function getborder(a){return getotborder(a)+getodborder(a)}function getborderSm(e){var d=$(e).css("margin-top");var c=$(e).css("margin-bottom");var b=$(e).css("border-top-width");var a=$(e).css("border-bottom-width");var g=0;if(d){var f=parseFloat(d.replace("px",""));if(!isNaN(f)){g+=f}}if(c){var f=parseFloat(c.replace("px",""));if(!isNaN(f)){g+=f}}if(b){var f=parseFloat(b.replace("px",""));if(!isNaN(f)){g+=f}}if(a){var f=parseFloat(a.replace("px",""));if(!isNaN(f)){g+=f}}return g}function getwborder(a){return getolwborder(a)+getorwborder(a)}function getolwborder(c){var d=$(c).css("padding-left");var b=$(c).css("margin-left");var a=$(c).css("border-left-width");var f=0;if(d){var e=parseFloat(d.replace("px",""));if(!isNaN(e)){f+=e}}if(b){var e=parseFloat(b.replace("px",""));if(!isNaN(e)){f+=e}}if(a){var e=parseFloat(a.replace("px",""));if(!isNaN(e)){f+=e}}return f}function getorwborder(c){var d=$(c).css("padding-right");var b=$(c).css("margin-right");var a=$(c).css("border-right-width");var f=0;if(d){var e=parseFloat(d.replace("px",""));if(!isNaN(e)){f+=e}}if(b){var e=parseFloat(b.replace("px",""));if(!isNaN(e)){f+=e}}if(a){var e=parseFloat(a.replace("px",""));if(!isNaN(e)){f+=e}}return f}function getotborder(c){var d=$(c).css("padding-top");var b=$(c).css("margin-top");var a=$(c).css("border-top-width");var f=0;if(d){var e=parseFloat(d.replace("px",""));if(!isNaN(e)){f+=e}}if(b){var e=parseFloat(b.replace("px",""));if(!isNaN(e)){f+=e}}if(a){var e=parseFloat(a.replace("px",""));if(!isNaN(e)){f+=e}}return f}function getontborder(c){var b=$(c).css("margin-top");var a=$(c).css("border-top-width");var e=0;if(b){var d=parseFloat(b.replace("px",""));if(!isNaN(d)){e+=d}}if(a){var d=parseFloat(a.replace("px",""));if(!isNaN(d)){e+=d}}return e}function getodborder(c){var d=$(c).css("padding-bottom");var b=$(c).css("margin-bottom");var a=$(c).css("border-bottom-width");var f=0;if(d){var e=parseFloat(d.replace("px",""));if(!isNaN(e)){f+=e}}if(b){var e=parseFloat(b.replace("px",""));if(!isNaN(e)){f+=e}}if(a){var e=parseFloat(a.replace("px",""));if(!isNaN(e)){f+=e}}return f}function getondborder(c){var b=$(c).css("margin-bottom");var a=$(c).css("border-bottom-width");var e=0;if(b){var d=parseFloat(b.replace("px",""));if(!isNaN(d)){e+=d}}if(a){var d=parseFloat(a.replace("px",""));if(!isNaN(d)){e+=d}}return e}function findlayout(g){var h=$(g).prev(".layout-top");var i=h.height()+getborder(h);var a=$(g).next(".layout-bottom");var b=a.height()+getborder(a);var c=$(g).parents(".layout-box");var d=c.height()-getborderSm($(c));var f=d-b-i-getborder(g);g.height(f);if($(g).find(".layout-center").get(0)){var e=$(g).find(".layout-center").eq(0);findlayout(e)}}Array.prototype.remove=function(a){if(isNaN(a)||a>this.length){return false}for(var b=0,c=0;b<this.length;b++){if(this[b]!=this[a]){this[c++]=this[b]}}this.length-=1};String.prototype.fill=function(a){if(typeof a==="object"&&a){return this.replace(/{{(.+?)}}/g,function(b,c){var d=a[c];if(d==undefined||d==null){return b}else{if(typeof(d)=="object"){return stringify(d)}else{return d}}})}};String.prototype.replaceo=function(a,b){return this.replace("{{"+a+"}}",b)};var queryString={__init__:function(){var c=window.location.search.slice(1).split(/\&/g);for(var a=0;a<c.length;a++){var d=/^(.+)[?=\\=](.+)/g,b=d.exec(c[a]);if(b){this[b[1]]=b[2]}}}};queryString.__init__();function getrequestparam(b){var c;var e=window.location.search.slice(1).split(/\&/g);for(var a=0;a<e.length;a++){var f=/^(.+)[?=\\=](.+)/g,d=f.exec(e[a]);if(d){c[d[1]]=d[2]}}return c[b]}function stringToJSON(obj){try{return eval("("+obj+")")}catch(e){alert("你的数据不符合规范！请检查！")}}var stringify=function(d){if(window.JSON){return JSON.stringify(d)}var f=typeof(d);if(f!="object"||d===null){if(f=="string"){d='"'+d+'"'}return String(d)}else{var c,g,b=[],a=(d&&d.constructor==Array);var e=arguments.callee;for(c in d){g=d[c];f=typeof(g);if(d.hasOwnProperty(c)){if(f=="string"){g='"'+g+'"'}else{if(f=="object"&&g!==null){g=e(g)}}b.push((a?"":'"'+c+'":')+String(g))}}return(a?"[":"{")+String(b)+(a?"]":"}")}};
/*
 * 多级联动
 * 创建人：qinnailin
 * 创建时间：2014/11/14
 *
 *
 * 
 */
!(function(a){var b=function(c,d){this.init("cascade",c,d)};b.prototype={constructor:b,init:function(f,d,e){this.type=f,this.$element=a(d),this.opstions=this.getOpstions(e);this.$id=a(d).attr("id");var c=this;if(this.opstions.url==""&&this.opstions.data!=null){this.load()}else{if(this.opstions.url!=""){a.getJSON(this.opstions.url,function(g){c.opstions.data=g;c.load()})}}},getOpstions:function(c){return c=a.extend({},a.fn[this.type].defaults,c)},load:function(){var c=this;this.$items=new Array();if(c.opstions.items){a.each(c.opstions.items,function(d,e){var g=c.$id+"-child-"+d;if(!a("#"+g).get(0)){c.$element.append('<label style="float:left;margin:5px;">'+e.title+':</label><div id="'+g+'" fm-name="'+e.name+'" style="float:left;margin-left:5px;" ></div>')}var f=a("#"+g).selectbox({data:[],param:e.param,defaults:null,change:function(h){c.change(d,h)}});c.$items.push(f)});c.$items[0].reload(c.opstions.data[c.opstions.items[0].name])}},change:function(g,d){if(g==this.opstions.items.length-1){return false}var c=new Array();var e=this.opstions.items[g+1];var f=e.pid;a.each(this.opstions.data[e.name],function(h,j){if(j[f]==d){c.push(j)}});this.$items[g+1].reload(c)}};a.fn.cascade=function(c){return this.each(function(){var d=a(this),e=d.data("cascade");if(!e){d.data("cascade",(e=new b(this,c)))}if(typeof c=="string"){a.getJSON(c,function(f){e.opstions.data=f;e.load()})}})};a.fn.cascade.defaults={url:"",data:null,items:[]}})(window.jQuery);
/*
 * 图表插件
 * 创建人：qinnailin
 * 创建时间：2014/8/25 
 *
 *
 * 
 */
(function(a){a.extend({init:function(c){var b=a.extend(true,{echarts:"plugIn/charts/echarts","echarts/chart/bar":"plugIn/charts/echarts-map","echarts/chart/line":"plugIn/charts/echarts-map","echarts/chart/pie":"plugIn/charts/echarts-map","echarts/chart/radar":"plugIn/charts/echarts-map"},c);require.config({paths:b})}});a.fn.extend({bar:function(i){var h=a.extend(true,{title:"",subtitle:"",showtype:"V",data:null,url:"",afterCreate:null,showtag:true,async:{enable:false,url:"",params:{},filer:"Id",name:"-",sleep:1000,size:20,insert:false}},i);var g=a(this);var f;var d;if(h.url!=""){a.getJSON(h.url,function(k){h.data=k;var l=e();b(l)})}else{var j=e();b(j)}function e(){var p,r,o,q;if((h.data==null||h.data.length==0)&&h.async.enable){h.data=a.initEmpty([h.async.name],h.async.size)}if(h.showtype=="V"||h.showtype=="v"){p="category";r="value";o=h.data.category;q=null}else{p="value";r="category";o=null;q=h.data.category}var k=new Array();var l=new Array();a.each(h.data.values,function(s,t){k.push({name:t.name,type:"bar",data:t.value});if(h.async.enable){d=t[h.async.filer]}l.push(t.name)});var m={title:{text:h.title,subtext:h.subtitle},tooltip:{show:true},legend:{data:l},xAxis:[{type:p,data:o}],yAxis:[{type:r,data:q}],series:k};if(!h.showtag){m.legend=null}if(!h.showtag&&h.title==""&&h.subtitle==""){m.grid={y:10,x:30,y2:30,x2:10}}return m}function b(k){require(["echarts","echarts/chart/bar"],function(l){f=l.init(a(g).get(0));f.setOption(k);if(h.afterCreate){h.afterCreate(f)}if(h.async.enable){var m;clearInterval(m);m=setInterval(function(){var o=h.async.params;o.filer=d;a.getJSON(h.async.url,o,function(p){a.each(p,function(q,r){f.addData([[0,r.value,true,h.async.insert,r.key]]);d=r.value})})},h.async.sleep)}})}var c={reload:function(k){if(!f){alertui("请等待图标加载完毕后调用！");return false}f.clear();if(k instanceof Object){h.data=k;var l=e();f.setOption(l);f.refresh()}else{h.data=null;h.url=k;a.getJSON(h.url,function(m){h.data=m;var o=e();f.setOption(o);f.refresh()})}}};return c},line:function(i){var h=a.extend(true,{title:"",subtitle:"",data:null,showtype:"V",url:"",symbol:"",smooth:true,showtag:true,dataZoom:{show:false,realtime:true,start:0,end:100},afterCreate:null,async:{enable:false,url:"",params:{},filer:"Id",name:"-",sleep:1000,size:20,insert:false}},i);var g=a(this);var f;var d;if(h.url!=""){a.getJSON(h.url,function(k){h.data=k;var l=e();b(l)})}else{var j=e();b(j)}function e(){var o,p;if((h.data==null||h.data.length==0)&&h.async.enable){h.data=a.initEmpty([h.async.name],h.async.size)}if(h.showtype=="V"||h.showtype=="v"){o={type:"category",boundaryGap:false,data:h.data.category};p={type:"value"}}else{p={type:"category",boundaryGap:false,data:h.data.category};o={type:"value"}}var k=new Array();var l=new Array();a.each(h.data.values,function(q,r){k.push({name:r.name,type:"line",symbol:h.symbol,smooth:h.smooth,data:r.value});if(h.async.enable){d=r[h.async.filer]}l.push(r.name)});var m={title:{text:h.title,subtext:h.subtitle},tooltip:{show:true,trigger:"axis"},dataZoom:h.dataZoom,legend:{data:l},xAxis:[o],yAxis:[p],series:k};if(!h.showtag){m.legend=null}if(!h.showtag&&h.title==""&&h.subtitle==""){m.grid={y:10,x:30,y2:30,x2:10}}return m}function b(k){require(["echarts","echarts/chart/line"],function(l){f=l.init(a(g).get(0));f.setOption(k);if(h.afterCreate){h.afterCreate(f)}if(h.async.enable){var m;clearInterval(m);m=setInterval(function(){var o=h.async.params;o.filer=d;a.getJSON(h.async.url,o,function(p){a.each(p,function(q,r){f.addData([[0,r.value,true,h.async.insert,r.key]]);d=r.value})})},h.async.sleep)}})}var c={reload:function(k){if(!f){alertui("请等待图标加载完毕后调用！");return false}f.clear();if(k instanceof Object){h.data=k;var l=e();f.setOption(l);f.refresh()}else{h.data=null;h.url=k;f.showLoading();a.getJSON(h.url,function(m){h.data=m;var o=e();f.setOption(o);f.refresh();f.hideLoading()})}}};return c},pie:function(e){var d=a.extend(true,{title:"",titleX:"center",subtitle:"",data:null,url:"",legendPos:"left",showlable:true,itemStyle:{normal:{label:{show:true},labelLine:{show:true}}},afterCreate:null},e);var c=a(this);if(d.url!=""){a.getJSON(d.url,function(f){d.data=f;b()})}else{b()}function b(){var f=new Array();var h=new Array();a.each(d.data,function(j,k){h.push(k.name)});var g={normal:{label:{show:true},labelLine:{show:true}}};if(!d.showlable){g={normal:{label:{show:false},labelLine:{show:false}}}}var i={title:{text:d.title,subtext:d.subtitle,x:d.titleX},tooltip:{trigger:"item",formatter:"{b} : {c} ({d}%)"},legend:{orient:"vertical",x:d.legendPos,data:h},series:[{type:"pie",itemStyle:g,radius:"55%",center:["50%","60%"],data:d.data}]};require(["echarts","echarts/chart/pie"],function(j){var k=j.init(a(c).get(0));k.setOption(i);if(d.afterCreate){d.afterCreate(k)}})}},radar:function(e){var d=a.extend(true,{title:"",subtitle:"",style:null,data:null,url:"",afterCreate:null},e);var c=a(this);if(d.url!=""){a.getJSON(d.url,function(f){d.data=f;b()})}else{b()}function b(){var g=new Array();var h=new Array();a.each(d.data.values,function(j,k){h.push(k.name)});var f={};if(d.style=="fill"){f={areaStyle:{type:"default"}}}var i={title:{text:d.title,subtext:d.subtitle},tooltip:{trigger:"axis"},legend:{orient:"vertical",x:"right",y:"bottom",data:h},polar:[{indicator:d.data.indicator}],series:[{type:"radar",itemStyle:{normal:f},data:d.data.values}]};require(["echarts","echarts/chart/radar"],function(j){var k=j.init(a(c).get(0));k.setOption(i);if(d.afterCreate){d.afterCreate(k)}})}},charts:function(c,e,b){var d=a(this);require(["echarts","echarts/chart/"+c],function(f){var g=f.init(a(d).get(0));g.setOption(e);if(b){b(g)}})}});a.extend({initEmpty:function(d,e){var f=new Array();var g=new Array();for(var c=0;c<e;c++){f.push("-");g.push(0)}var h=new Array();a.each(d,function(j,k){h.push({name:k,value:g})});var b={category:f,values:h};return b}})})(jQuery);
/*
 * 页面数据填充控件
 * 创建人：qinnailin
 * 创建时间：2014/7/5 
 */
(function($){$.fn.Detail=function(options){var ops=$.extend({data:null,url:"",source:"",idname:"id",afterCreate:null},options||{});var objthis=$(this);var template=$(objthis).html();var requrl="";if(queryString[ops.idname]){var urlparam=ops.idname+"="+queryString[ops.idname];if(ops.url.indexOf("?")>-1){requrl=ops.url+"&"+urlparam}else{requrl=ops.url+"?"+urlparam}loadData()}else{if(ops.url!=""&&ops.data==null){requrl=ops.url;loadData()}else{loadData()}}function loadData(){if(requrl!=""){$.getJSON(requrl,function(rd){var data;if(ops.source==""){data=rd}else{var temp=rd;var item=ops.source.split(".");$.each(item,function(i,n){if(n!=""){temp=temp[n]}});data=temp}$(objthis).html(template.fill(data));converfunc();if(ops.afterCreate){ops.afterCreate()}})}else{if(ops.data){$(objthis).html(template.fill(ops.data));converfunc()}}}function converfunc(){var clist=$(objthis).find("[fm-conver]");$.each(clist,function(i,n){var txt=$(n).html();var convfn=$(n).attr("fm-conver");var fn=eval(convfn);var cvres=fn(txt);$(n).html(cvres)})}var func={load:function(obj){if(obj instanceof Object){requrl="";ops.data=obj;loadData()}else{var urlparam=ops.idname+"="+obj;if(ops.url.indexOf("?")>-1){requrl=ops.url+"&"+urlparam}else{requrl=ops.url+"?"+urlparam}loadData()}},reload:function(){loadData()},refresh:function(){window.location.reload()}};return func}})(jQuery);
/*
 * js上传控件
 * 创建人：qinnailin
 * 创建时间：2014/9/10
 *
 * 
 */
(function(a){a.fn.extend({jsUpload:function(d){var b=a(this);var c=a.extend(true,{element:a(b).get(0),debug:false,multiple:false,maxConnections:3,showStart:true,autoUpload:false,request:{endpoint:"/data/upload.aspx",params:{},customHeaders:{},forceMultipart:false,inputName:"qqfile"},validation:{allowedExtensions:[],sizeLimit:2*1024*1024,minSizeLimit:0,stopOnFirstInvalidFile:true},showMessage:function(h){if(typeof alertui=="function"){alertui(h)}else{alert(h)}}},d);if(!c.showStart){var f=c.callbacks.onUpload;c.callbacks.onUpload=function(i,h,j){meddleloading(true);if(f){f(i,h,j)}};var e=c.callbacks.onComplete;c.callbacks.onComplete=function(j,i,h){if(e){e(j,i,h)}meddleloading(false)}}var g=new qq.FineUploader(c);a(document).ready(function(){a(b).on("click",".qq-doupload-button",function(){g.uploadStoredFiles()})});if(!c.showStart){a(g._listElement).hide()}return g}})})(jQuery);
/*
 * 手风琴菜单
 * 创建人：qinnailin
 * 创建时间：2014/8/10 
 *
 *
 * 
 */
(function(a){a.fn.FoldMenu=function(h){var g=a.extend(true,{url:"",data:null,source:"",child:"Child",key:"Id",text:"Name",width:220,selected:function(j){}},h);var f=a(this);a(f).addClass("fm-fold").css("width",g.width);e();function e(){if(g.url==""&&g.data!=null){c()}else{if(g.url!=""){a.getJSON(g.url,function(k){var l=k;var j=g.source.split(".");a.each(j,function(m,o){if(o!=""){l=l[o]}});g.data=l;c()})}}}function c(){var j='<ul class="menu-one" '+(g.width!=220?"style='width:"+g.width+"px'":"")+">";var k="<li "+(g.width!=220?"style='width:"+g.width+"px'":"")+' ><div class="header"><span class="txt">{{'+g.text+'}}</span><span class="arrow"></span></div>{{childs}}</li>';a.each(g.data,function(l,m){j+=k.fill(m).replaceo("childs",b(m[g.child]))});j+="</ul>";a(f).html(j);i()}function b(j){if(j&&j.length>0){var k='<ul class="menu-two" '+(g.width!=220?"style='width:"+g.width+"px'":"")+" >";var l="<li "+(g.width!=220?"style='width:"+g.width+"px'":"")+'  ><a href="javascript:" data-sel="{{Selected}}" data-id="{{'+g.key+'}}" >{{'+g.text+"}}</a></li>";a.each(j,function(m,o){k+=l.fill(o)});k+="</ul>";return k}else{return""}}function i(){a(f).find("a").each(function(j,k){if(a(k).attr("data-sel").toUpperCase()=="TRUE"){a(k).parents("ul").show();a(k).parents("li").addClass("menu-show");g.selected(a(k).attr("data-id"));return}});a(f).find("li").eq(0).addClass("firstChild");a(f).find("ul").each(function(j,k){a(k).find("li").eq(0).addClass("firstChild")})}a(document).ready(function(){a(f).on("click",".header",function(){if(a(this).parent("li").hasClass("menu-show")){a(this).next("ul").slideUp(300);a(this).parent("li").removeClass("menu-show")}else{a(this).next("ul").slideDown(300);a(this).parent("li").addClass("menu-show")}a(this).parent("li").siblings("li").removeClass("menu-show").find("ul").slideUp(300)});a(f).on("click","a",function(){var j=a(this).attr("data-id");g.selected(j)})});var d={};return d}})(jQuery);
/*
 * form表单验证及初始化
 *创建人：qinnailin
 * 创建时间：2014/7/16 
 *
 *
 标签说明：
 fm-form="ajax" form使用ajax提交数据 不加入标签为普通提交
 fm-null="用户名不能为空！" 空验证
 fm-len="4,20,用户名长度必须大于4小于20！"  字符长度验证，
 fm-ajax="/user/has,用户名已存在!"  ajax验证
 fm-eq="pwd,两次输入密码不一致！" 相等验证 pwd为对比标签的name
 fm-reg="\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*,请输入正确的邮箱格式！" 正则表达式验证
 fm-group="radio,请选择性别！"  radio组验证 fm-group在radio外层
 fm-group="checkbox,2,4,请任选2项！最多4项！" checkbox 组验证 fm-group在checkbox外层
 fm-neq="-1,请选择地区!" 非验证 值不等于 -1
 * 
 */
(function($){$.fn.Form=function(options){var ops=$.extend(true,{url:"",data:null,source:"",idname:"id",success:function(data){infomsg("数据提交成功！")},error:function(data){errormsg("数据提交失败!")},offset:{top:0,left:0},afterLoad:null},options);var objthis=$(this);var requrl="";if(queryString[ops.idname]){var urlparam=ops.idname+"="+queryString[ops.idname];if(ops.url.indexOf("?")>-1){requrl=ops.url+"&"+urlparam}else{requrl=ops.url+"?"+urlparam}loadData()}else{if(ops.url!=""&&ops.data==null){requrl=ops.url;loadData()}}function loadData(){if(requrl!=""){$.getJSON(requrl,function(rd){var data;if(ops.source==""){data=rd}else{var temp=rd;var item=ops.source.split(".");$.each(item,function(i,n){if(n!=""){temp=temp[n]}});data=temp}if(data){$(objthis).find("[name]").each(function(i,item){var name=$(item).attr("name");if(($(item).is("input[type=checkbox]")||$(item).is("input[type=radio]"))){if($(item).val()==data[name]){$(item).attr("checked",true)}else{$(item).removeAttr("checked")}}else{if($(item).is("input")){$(item).val(data[name])}else{if($(item).is("select")){$(item).find("option[value="+data[name]+"]").attr("selected",true)}else{$(item).html(data[name])}}}})}converfunc();if(ops.afterLoad){ops.afterLoad(data)}})}else{if(ops.data){var data=ops.data;$(objthis).find("[name]").each(function(i,item){var name=$(item).attr("name");if(($(item).is("input[type=checkbox]")||$(item).is("input[type=radio]"))&&$(item).val()==data[name]){$(item).attr("checked",true)}else{if($(item).is("input")){$(item).val(data[name])}else{if($(item).is("select")){$(item).find("option[value="+data[name]+"]").attr("selected",true)}else{$(item).html(data[name])}}}})}converfunc()}}function converfunc(){var clist=$(objthis).find("[fm-conver]");$.each(clist,function(i,n){if($(n).is("input")){var txt=$(n).val();var convfn=$(n).attr("fm-conver");var fn=eval(convfn);var cvres=fn(txt);$(n).val(cvres)}else{var txt=$(n).html();var convfn=$(n).attr("fm-conver");var fn=eval(convfn);var cvres=fn(txt);$(n).html(cvres)}})}$.fn.vnull=function(){if($(this).val()==""){$(this).showError($(this).attr("fm-null"))}else{$(this).showSuccess()}};$.fn.vlen=function(){var v=$(this).attr("fm-len").split(",");var min=v[0]?parseInt(v[0]):0;var len=$(this).val().length;if(len<min||(v[1]!=""&&len>parseInt(v[1]))){$(this).showError(v[2])}else{$(this).showSuccess()}};$.fn.veq=function(){var v=$(this).attr("fm-eq").split(",");var tagv=$("[name="+v[0]+"]").val();if($(this).val()!=tagv){$(this).showError(v[1])}else{$(this).showSuccess()}};$.fn.vgroup=function(){var v=$(this).attr("fm-group").split(",");if(v[0]=="radio"){var radio=$(this).find("input:radio:checked").val();if(!radio){$(this).removeClass("success").addClass("error");$(this).showError(v[1])}else{$(this).removeClass("error").addClass("success");$(this).showSuccess()}}else{if(v[0]=="checkbox"){var size=$(this).find("input:checked").size();if((v[1]!=""&&size<parseInt(v[1]))||(v[2]!=""&&size>parseInt(v[2]))){$(this).removeClass("success").addClass("error");$(this).showError(v[3])}else{$(this).removeClass("error").addClass("success");$(this).showSuccess()}}}};$.fn.vneq=function(){var v=$(this).attr("fm-neq").split(",");if($(this).val()==v[0]){$(this).showError(v[1])}else{$(this).showSuccess()}};$.fn.vreg=function(){var v=$(this).attr("fm-reg").split(",");var msg="";var reqexpstr="";if(v.length>2){msg=v[v.length-1];var str=$(this).attr("fm-reg");reqexpstr=str.substring(0,str.lastIndexOf(","))}else{msg=v[1];reqexpstr=v[0]}var r=RegExp(reqexpstr);if(!r.test($(this).val())){$(this).showError(msg)}else{$(this).showSuccess()}};$.fn.vajax=function(){var v=$(this).attr("fm-ajax").split(",");if($(this).attr("fm-ajax-res")=="false"){var v=$(this).attr("fm-ajax").split(",");$(this).showError(v[1])}else{if($(this).attr("fm-ajax-res")==""){valid=false;$(this).showError(v[1])}}};function validation(){valid=true;$(objthis).find("[fm-null]").each(function(i,n){$(n).vnull()});$(objthis).find("[fm-len]").each(function(i,n){$(n).vlen()});$(objthis).find("[fm-eq]").each(function(i,n){$(n).veq()});$(objthis).find("[fm-group]").each(function(i,n){$(n).vgroup()});$(objthis).find("[fm-neq]").each(function(i,n){$(n).vneq()});$(objthis).find("[fm-reg]").each(function(i,n){$(n).vreg()});$(objthis).find("[fm-ajax]").each(function(i,n){$(n).vajax()})}$(document).ready(function(){$(objthis).submit(function(){validation();var valid=$(objthis).find(".error").get(0);if(!valid){if($(objthis).attr("fm-form")&&$(objthis).attr("fm-form")=="ajax"){$.ajax({url:this.action,type:this.method,cache:false,data:$(this).serialize(),success:function(result){ops.success(result)},error:function(result){ops.error(result)}});return false}else{return true}}else{return false}return false});$(objthis).on("blur","input[fm-ajax]",function(){var oth=$(this);var v=$(oth).attr("fm-ajax").split(",");var key=$(this).attr("name");var val=$(this).val();if(val!=""){var data=key+"="+val;$.ajax({url:v[0],type:"get",data:data,success:function(result){if(result.flag){$(oth).attr("fm-ajax-res","true");$(this).showSuccess()}else{$(oth).showError(v[1]);$(oth).attr("fm-ajax-res","false")}},error:function(result){$(oth).showError("数据请求失败");$(oth).attr("fm-ajax-res","false")}})}});$(objthis).on("blur","input",function(){var oth=$(this);var alen=$(oth).get(0).attributes.length;for(var i=0;i<alen;i++){var name=$(oth).get(0).attributes[i].name;switch(name){case"fm-null":$(oth).vnull();break;case"fm-len":$(oth).vlen();break;case"fm-eq":$(oth).veq();break;case"fm-neq":$(oth).vneq();break;case"fm-reg":$(oth).vreg();break;default:}}});$(objthis).on("blur","textarea",function(){var oth=$(this);var alen=$(oth).get(0).attributes.length;for(var i=0;i<alen;i++){var name=$(oth).get(0).attributes[i].name;switch(name){case"fm-null":$(oth).vnull();break;case"fm-len":$(oth).vlen();break;default:}}});$(objthis).on("blur","select",function(){var oth=$(this);var alen=$(oth).get(0).attributes.length;for(var i=0;i<alen;i++){var name=$(oth).get(0).attributes[i].name;switch(name){case"fm-neq":$(oth).vneq();break;default:}}});$(objthis).on("focus","input",function(){$(this).removeError()});$(objthis).on("click","input:radio",function(){$(this).parent(".error").removeError()});$(objthis).on("click","input:checkbox",function(){$(this).parent(".error").removeError()});$(objthis).on("focus","textarea",function(){$(this).removeError()});$(objthis).on("focus","select",function(){$(this).removeError()});$(objthis).on("change","input",function(){$(this).removeError()});$(objthis).on("change","textarea",function(){$(this).removeError()});$(objthis).on("change","select",function(){$(this).removeError()})});var func={load:function(opst){if(opst instanceof Object){ops.data=opst;requrl="";loadData()}else{var urlparam=ops.idname+"="+id;if(ops.url.indexOf("?")>-1){requrl=ops.url+"&"+urlparam}else{requrl=ops.url+"?"+urlparam}loadData()}},reload:function(){window.location.reload()},refresh:function(){loadData()},reset:function(){$(objthis)[0].reset();$(objthis).find("input").val("")},closemsg:function(){$("div.u_warn").remove()},validation:function(){$(objthis).find(".error").removeClass("error");validation();return !$(objthis).find(".error").get(0)}};return func};$.fn.showError=function(msg){$(this).removeClass("error").addClass("error");$(this).attr("data-title",msg).Tooltip({placement:"bottom",template:'<div class="tooltip form"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})};$.fn.showSuccess=function(){$(this).removeClass("error");$(this).attr("data-title","");$(".tooltip").remove()};$.fn.removeError=function(){$(this).removeClass("error");$(this).attr("data-title","");$(".tooltip").remove()}})(jQuery);
/*
 * 列表控件 带分页的表格控件
 *创建人：qinnailin
 * 创建时间：2014/7/4 
 */
(function($){$.fn.Grid=function(options){var ops=$.extend(true,{url:"",data:null,dataformat:{data:"Data",count:"Count"},click:null,dbclick:null,method:"Get",dataType:"json",sortMultiple:true,putJson:true,cache:true,page:{click:null,pageSize:30,pageIndex:1,back:"上一页",next:"下一页",reqindex:"pageindex",reqsize:"pagesize",lazy:null},afterLoad:null},options);var objthis=$(this);var thisid=$(objthis).attr("id");var template;var ajaxData;if(!document.getElementById(thisid+"_template")){template=findTemp(objthis,ops);$("body").append("<script type='text/template' id='"+thisid+"_template' >"+template+"</script>")}else{template=$("#"+thisid+"_template").html()}var tempbox=findTempBox(objthis);tempbox.html("");var pagecount=0;var listcount=0;var pageIndex=1;var requesturl="";var sortdata={};var func={reload:function(){pageIndex=1;if($(objthis).find("[fm-pagerbox]").get(0)){$(objthis).find("[fm-pagerbox]").find(".pageindex").text(1)}initReqUrl();loaddata()},refresh:function(){ops.data=null;loaddata()},load:function(opst){if(opst instanceof Object){ops.data=opst}else{ops.data=null;ops.url=opst}pageIndex=1;initReqUrl();loaddata()},getData:function(){return ops.data},getAjaxData:function(){return ajaxData}};function initReqUrl(){var pagediv=$(objthis).find("[fm-pagerbox]").html();if(pagediv!=undefined){var urlparam=ops.page.reqindex+"="+((ops.page.pageIndex-1)+pageIndex)+"&"+ops.page.reqsize+"="+ops.page.pageSize;if(ops.url.indexOf("?")>-1){requesturl=ops.url+"&"+urlparam}else{requesturl=ops.url+"?"+urlparam}}else{requesturl=ops.url}}initReqUrl();loaddata();function loaddata(){if(ops.url==""&&ops.data!=null){fillData(ops,template);if(ops.page.lazy){ops.url=ops.page.lazy.url;listcount=ops.page.lazy.count;bindPager()}converfunc();if(ops.afterLoad){ops.afterLoad()}}else{if(ops.url!=""){var value=$(objthis).find("[fm-search]").serialize();var daval;if(ops.putJson){if(value){var sstr=value.split("&");var temp=new Array();for(var i=0;i<sstr.length;i++){var v=sstr[i].split("=");if(v[1]){temp.push(v[0]+":'"+v[1]+"'")}}daval=temp.join(",");daval='{jsonStr:"{'+daval+"}\",sort:'"+stringify(sortdata)+"'}";daval=eval("("+daval+")")}else{if(jsonsize(sortdata)>0){daval="{sort:'"+stringify(sortdata)+"'}";daval=stringToJSON(daval)}}}else{if(!$(objthis).find("form[fm-search]").get(0)){$(objthis).append("<form fm-search ></form>")}if($(objthis).find("form[fm-search]").find("input[name=sort]").get(0)){if(jsonsize(sortdata)>0){$(objthis).find("form[fm-search]").find("input[name=sort]").val(stringify(sortdata))}}else{if(jsonsize(sortdata)>0){$(objthis).find("form[fm-search]").append("<input type='hidden' name='sort' value='"+stringify(sortdata)+"' />")}}daval=$(objthis).find("[fm-search]").serialize()}$.ajax({url:requesturl,data:daval,type:ops.method,dataType:ops.dataType,cache:ops.cache,success:function(result){try{if(result.utrymsg&&result.utrymsg!=""){return false}}catch(e){}ajaxData=result;listcount=result[ops.dataformat.count];ops.data=result[ops.dataformat.data];fillData(ops,template);converfunc();var pager=$(objthis).find("[fm-pagerbox]").html();if(pager!=undefined){pagecount=GetCountPage(listcount,ops.page.pageSize);$(objthis).find("[fm-pagerbox]").find(".pagecount").text(pagecount);if(pagecount==pageIndex){$(objthis).find("[fm-pagerbox]").find(".next").addClass("active")}else{$(objthis).find("[fm-pagerbox]").find(".next").removeClass("active")}}if(ops.afterLoad){ops.afterLoad(result)}},error:function(result){errormsg("数据获取失败！")}})}}}function bindPager(){var pages='<p class="page_num"><a href="javascript:" class="page_pre back"></a><span class="fir_page pageindex">1</span><span class="line_page">/</span><span class="las_page pagecount">1</span><a href="javascript:" class="page_nex next"></a><input type="text" class="goTo_page" /><input type="button" class="btn gotobtn" value="跳页" /></p>';$(objthis).find("[fm-pagerbox]").html(pages)}function converfunc(){var clist=$(objthis).find("[fm-conver]");$.each(clist,function(i,n){var txt=$(n).html();var convfn=$(n).attr("fm-conver");var fn=eval(convfn);var cvres=fn(txt);$(n).html(cvres)})}$(document).ready(function(){bindPager();if(ops.click!=null){$(objthis).on("click","[fm-row]",function(){var id=$(this).attr("fm-row");var data=ops.data[id];ops.click(data)})}if(ops.dbclick!=null){$(objthis).on("dblclick","[fm-row]",function(){var id=$(this).attr("fm-row");var data=ops.data[id];ops.dbclick(data)})}$(objthis).on("click","[fm-pagerbox]>p>a",function(){if($(this).hasClass("active")){return}if($(this).hasClass("back")){if(pageIndex==1){$(this).addClass("active");return}if(--pageIndex>1){$(this).removeClass("active")}$(objthis).find("[fm-pagerbox]").find(".next").removeClass("active");$(objthis).find("[fm-pagerbox]").find(".pageindex").text(pageIndex);bindPageEvent()}else{if($(this).hasClass("next")){if(++pageIndex<pagecount){$(this).removeClass("active")}$(objthis).find("[fm-pagerbox]").find(".back").removeClass("active");$(objthis).find("[fm-pagerbox]").find(".pageindex").text(pageIndex);bindPageEvent()}}});$(objthis).on("click","[fm-pagerbox]>p>.gotobtn",function(){var val=parseInt($(objthis).find("[fm-pagerbox]>p>input.goTo_page").val());if(pageIndex!=val&&val>=ops.page.pageIndex&&val<=pagecount){pageIndex=val;initReqUrl();loaddata();if(ops.page.click){ops.page.click(pageIndex,ops.page.pageSize,listcount)}}$(objthis).find("[fm-pagerbox]").find(".pageindex").text(pageIndex)});$(objthis).find("form[fm-search]").eq(0).submit(function(){func.reload();return false});$(objthis).find("[fm-sort]").addClass("sort_head");$(objthis).find("[fm-sort]").each(function(i,n){$(n).append("<a class='sort_pre_next' ></a>")});$(objthis).on("click","[fm-sort]",function(){if(!ops.sortMultiple){$(this).siblings("[fm-sort]").children("a").removeClass("sort_pre").remove("sort_next").addClass("sort_pre_next")}var value=-1;var oth=$(this).children("a");if($(oth).hasClass("sort_pre_next")){$(oth).removeClass("sort_pre_next").addClass("sort_pre");value=0}else{if($(oth).hasClass("sort_pre")){$(oth).removeClass("sort_pre").addClass("sort_next");value=1}else{if($(oth).hasClass("sort_next")){$(oth).removeClass("sort_next").addClass("sort_pre_next");value=-1}}}sortsetdata($(this),value)})});function jsonsize(obj){var count=0;for(var i in obj){count++}return count}function sortsetdata(obj,val){if(!ops.sortMultiple){sortdata={}}var key=$(obj).attr("fm-sort");sortdata['"'+key+'"']=val;if(val=-1){try{delete sortdata[key]}catch(e){}}pageIndex=1;initReqUrl();if($(objthis).find("[fm-pagerbox]").get(0)){$(objthis).find("[fm-pagerbox]").find(".pageindex").text(1)}var str=stringify(sortdata).replace(/\\"/g,"");sortdata=stringToJSON(str);loaddata()}function pageChange(){initReqUrl();loaddata()}function bindPageEvent(){pageChange();if(ops.page.click!=null){ops.page.click(pageIndex,ops.page.pageSize,listcount)}}function GetCountPage(pageCount,pageSize){if(pageCount<pageSize){return 1}else{if(pageCount>0){if(pageCount%pageSize==0){return maxpage=pageCount/pageSize}else{return parseInt((pageCount/pageSize))+1}}}return 0}function fillData(ops,template){var d=ops.data;$(tempbox).empty();if(d&&d.length>0){try{$.each(d,function(i,n){$(tempbox).append($(template.fill(n).replaceo("fm-row-num",i)).data("jsondata",n))})}catch(e){console.debug(template);console.debug(e)}}}function setTempRow(temp){var obj=$(temp).attr("fm-row","{{fm-row-num}}").get(0);var div=document.createElement("div");div.appendChild(obj);return $(div).html()}function findTemp(obj,ops){var temphtml=$(obj).find("[fm-body]").html();if(ops.click!=null||ops.dbclick!=null){temphtml=setTempRow(temphtml)}return temphtml}function findTempBox(obj){return $(obj).find("[fm-body]")}return func}})(jQuery);
/*
 * GridTree表格树控件 不用表格做，肯定有问题
 * 创建人：qinnailin
 * 创建时间：2015/1/5 
 */
!(function(a){var b=function(c,d){this.init("GridTree",c,d)};b.prototype={init:function(g,d,f){var e;this.type=g,this.$element=a(d),this.$id=a(d).attr("id"),this.options=e=this.getoptions(f),this.tempBox=this.getTempBox(),this.template=this.getTemp();this.tempBox.addClass("fm-ulgtree");this.tempBox.html("");this.loadData();var c=this;this.tempBox.on("click","span.switch",function(){var k=a(this).parents("li").eq(0);var i=a(this).siblings("span.chk").hasClass("checkbox_true_full_focus");if(!k.children("div").hasClass("t_open")){var j=k.data("rowdata");if(j[c.options.dataFormat.open]){var l="";if(e.param){l="{";var h=new Array();a.each(e.param,function(m,o){h.push("'"+e.param[m]+"':'"+j[e.param[m]]+"'")});l+=h.join(",");l+="}"}a.getJSON(e.url,stringToJSON(l),function(m){var p;if(e.source!=""){var q=m;var o=e.source.split(".");a.each(o,function(r,s){if(s!=""){q=q[s]}});p=q}c.fillAjaxNode(k,j,p,i);c.open(k)})}else{if(j[c.options.dataFormat.child]){c.fillNode(k,j,i);c.open(k)}else{c.open(k)}}}else{c.fold(k)}return false});this.tempBox.on("click","span.chk",function(){var h=a(this);c.checked(h);return false});this.tempBox.on("click",".cols",function(){c.selected(a(this));return false})},getoptions:function(c){return a.extend({},a.fn[this.type].defaults,c)},getTempBox:function(){this.$element.addClass("box-border").append("<div><ul></ul></div>").append("<div><ul></ul></div>");var d=this.$element.children("div").eq(0);d.addClass("row-fluid");d.children("ul").addClass("ul_grid_title");var c=this.$element.children("div").eq(1);c.addClass("row-fluid");var e=c.children("ul").addClass("ul_grid");return e},getTemp:function(){var f=this.options;var c=this;var e='<span class="line" {{layer}} ></span><span class="button switch center"></span>';if(f.treeModel=="checkbox"){e+='<span  class="button chk checkbox_false_full" ></span>'}e+='<span {{diyicon}} class="button {{icon2}}"></span>';var g="<div class='cols t_close' >";var d="<li><div class='cols'>";if(!f.header){alert("gridtree标头不可为空！");return false}a.each(f.header,function(j,k){var h;if(k.tree){h="<div>"+e+"<span class='text'>{{"+k.key+"}}</span></div>"}else{h="<div>{{"+k.key+"}}</div>"}if(k.width){g+=a(h).css("width",k.width+f.unit).get(0).outerHTML;d+=a("<div>"+k.name+"</div>").css("width",k.width+f.unit).get(0).outerHTML}else{alert("宽度是必填项！！");return false}});g+="</div>";d+="</div></li>";c.$element.find(".ul_grid_title").append(d);return g},loadData:function(){var d=this.options,c=this;if(d.data!=null){c.fillRoot(d.data);if(d.afterLoad){d.afterLoad()}}else{if(d.url!=""){a.getJSON(d.url,{_r_t:(d.cache?0:Math.random())},function(e){var g=e;if(d.source!=""){var h=e;var f=d.source.split(".");a.each(f,function(j,k){if(k!=""){h=h[k]}});g=h}c.fillRoot(g);if(d.afterLoad){d.afterLoad()}})}}},fillRoot:function(d){var e=this.options,c=this;a.each(d,function(o,p){p.tag_id=o;var j=p[e.dataFormat.child];p.icon2="ico";var m=c.filltrRootData(p),l=p,k=0,h,f;k=p.tag_id.toString().split("_").length-1;k=k==-1?0:k;if(e.expand!=0){l=c.copyobject(p)}m=(p[e.dataFormat.selected]?'<li class="selected" >':"<li>")+m+"</li>";var g=a(m);g.remove().appendTo(c.tempBox);h=c.tempBox.find("li:last");f=h.find(".chk");if(f&&p[e.dataFormat.checked]){f.addClass("checkbox_true_full_focus").removeClass("checkbox_false_full")}e.bindNode(p,h);if(j&&j.length>0&&e.expand!=0){c.fillChild(j,h,"");l[e.dataFormat.child]=null}h.data("rowdata",l);if(e.expand!=0){c.open(g)}})},fillChild:function(o,p,u){var t=this.options,h=this,j=p.children("ul");if(!j.get(0)){p.append("<ul></li>");j=p.children("ul")}for(var r=0;r<o.length;r++){var s=o[r];s.tag_id=u+"_"+r;var k=s[t.dataFormat.child];s.icon2=(k&&k.length>0)?"ico":"docu";var q=h.filltrData(s);var m=s;var l=0;l=s.tag_id.toString().split("_").length-1;l=l==-1?0:l;q=(s[t.dataFormat.selected]?'<li class="selected" >':"<li>")+q+"</li>";var f=a(q);f.remove().appendTo(j);var g=j.find("li:last");var e=g.find(".switch").eq(0),c=g.find(".chk").eq(0);if(s.icon2=="docu"&&!e.hasClass("docu")){e.addClass("docu")}if(c&&s[t.dataFormat.checked]){c.addClass("checkbox_true_full_focus").removeClass("checkbox_false_full")}t.bindNode(s,g);if(k&&k.length>0&&t.expand!=0){if(t.expand>0&&l>t.expand){g.data("rowdata",m);continue}else{h.fillChild(k,g,s.tag_id);h.open(f);m[t.dataFormat.child]=null;g.data("rowdata",m)}}}},fillNode:function(p,m,l){var t=this.options,h=this,u=m.tag_id,o=m[h.options.dataFormat.child];p.data("rowdata",h.copyobject(m));p.append("<ul></ul>");var j=p.children("ul").eq(0);for(var r=0;r<o.length;r++){var s=o[r];s.tag_id=u+"_"+r;var k=s[t.dataFormat.child];s.icon2=(k&&k.length>0)||(s[t.dataFormat.open])?"ico":"docu";var q=h.filltrData(s);var m=s;q="<li>"+q+"</li>";var f=a(q);if(l&&t.multiple){f.find(".chk").addClass("checkbox_true_full_focus")}j.append(f);var g=j.children("li:last"),c;var e=g.find(".switch").eq(0);if(s.icon2=="docu"&&!e.hasClass("docu")){e.addClass("docu")}c=g.find(".chk").eq(0);if(c&&s[t.dataFormat.checked]){c.addClass("checkbox_true_full_focus").removeClass("checkbox_false_full")}g.data("rowdata",m)}},fillAjaxNode:function(p,u,m,l){var t=this.options,h=this,v=u.tag_id,o=m;u[h.options.dataFormat.open]=false;p.data("rowdata",u);p.append("<ul></ul>");var j=p.children("ul").eq(0);for(var r=0;r<o.length;r++){var s=o[r];s.tag_id=v+"_"+r;var k=s[t.dataFormat.child];s.icon2=(k&&k.length>0)||(s[t.dataFormat.open])?"ico":"docu";var q=h.filltrData(s);var m=s;var f=a("<li>"+q+"</li>");if(l&&t.multiple){f.find(".chk").addClass("checkbox_true_full_focus")}j.append(f);var g=j.children("li:last"),c;var e=g.find(".switch").eq(0);if(s.icon2=="docu"&&!e.hasClass("docu")){e.addClass("docu")}c=g.find(".chk").eq(0);if(c&&s[t.dataFormat.checked]){c.addClass("checkbox_true_full_focus").removeClass("checkbox_false_full")}g.data("rowdata",m)}},copyobject:function(c){var e={};for(var d in c){if(d.toString()!=this.options.dataFormat.child){e[d]=c[d]}}return e},filltrRootData:function(f){var h=this.options,c=this,e=0;if(f){var g=c.template.fill(f).replaceo("layer","style=''").replaceo("diyicon",h.dataFormat.icon!=null?((f[h.dataFormat.icon]&&f[h.dataFormat.icon]!="")?'style="background: url('+f[h.dataFormat.icon]+') 0 0 no-repeat;"':""):"").replaceo("selected",f[h.dataFormat.selected]?'fm-sel="selected"':"").replaceo("data-id",f.tag_id);var d=false;if(h.clazz>0&&h.expand&&h.clazz<=(e+1)){d=true}return g}else{return""}},filltrData:function(f){var h=this.options,c=this,e=0;e=f.tag_id.toString().split("_").length-1;e=e==-1?0:e;if(f){var g=c.template.fill(f).replaceo("diyicon",h.dataFormat.icon!=null?((f[h.dataFormat.icon]&&f[h.dataFormat.icon]!="")?'style="background: url('+f[h.dataFormat.icon]+') 0 0 no-repeat;"':""):"").replaceo("selected",f[h.dataFormat.selected]?'fm-sel="selected"':"").replaceo("data-id",f.tag_id).replaceo("layer","style='padding-left:"+(e*18)+"px;'");var d=false;if(h.clazz>0&&h.expand&&h.clazz<=(e+1)){d=true}return g}else{return""}},serialize:function(d,g){var e=new Array(),c=this,f=this.options;a.each(d,function(k,j){var h=j[f.dataFormat.child];var l=c.copyobject(j);l.tag_id=g?g+"_"+k:k;e.push(l);if(h&&h.length>0){var m=c.serialize(h,l.tag_id);a.each(m,function(i,o){e.push(o)})}l.icon2=(h&&h.length>0||!g)?"ico":"docu"});return e},open:function(d){d.children("div.t_close").addClass("t_open").removeClass("t_close");var c=d.children("ul").show(200)},fold:function(d){d.children("div.t_open").addClass("t_close").removeClass("t_open");var c=d.children("ul").hide(200)},findParent:function(c){var f=c.prevAll("tr");var e=c.attr("id");var g=e.lastIndexOf("_");e=e.substring(0,g);for(var d=0;d<f.length;d++){if(a(f[d]).attr("id")==e){return a(f[d])}}return c},checkChild:function(d){var c=d.children("ul").children("li");c.each(function(e,f){a(f).find(".chk").addClass("checkbox_true_full_focus").removeClass("checkbox_false_full")})},noCheckChild:function(d){var c=d.children("ul").children("li");c.each(function(e,f){a(f).find(".chk").addClass("checkbox_false_full").removeClass("checkbox_true_full_focus")})},selected:function(e){var d=e.parents("li").data("rowdata");var f=this.options;var c=true;if(f.beforeSelect){c=f.beforeSelect(d,e);if(c==undefined){c=true}}if(c){if(e.parent("li").hasClass("selected")){e.parent("li").removeClass("selected")}else{if(!this.options.multiple){this.$element.find("li").removeClass("selected");e.parent("li").addClass("selected")}else{e.parent("li").addClass("selected");this.options.selected(d)}}}},checked:function(e){var f=e.parents("li").eq(0);var d=e.parents("li").data("rowdata");var g=this.options;var c=true;if(g.beforeCheck){c=g.beforeCheck(d,e);if(c==undefined){c=true}}if(c){if(!this.options.multiple){this.$element.find(".checkbox_true_full_focus").addClass("checkbox_false_full").removeClass("checkbox_true_full_focus")}if(e.hasClass("checkbox_false_full")){e.addClass("checkbox_true_full_focus").removeClass("checkbox_false_full");if(!this.options.multiple){return false}this.checkChild(f)}else{e.addClass("checkbox_false_full").removeClass("checkbox_true_full_focus");this.noCheckChild(f)}}},getCheckNodes:function(){var c=new Array();this.$element.find(".checkbox_true_full_focus").each(function(d,e){var f=a(e).parents("li").eq(0);c.push(f.data("rowdata"))});return c},getSelectNodes:function(){var c=new Array();this.$element.find(".selected").each(function(d,e){c.push(a(e).data("rowdata"))});return c},setSelected:function(c){c.addClass("selected")},setChecked:function(d){var c=$li.find(".chk").eq(0);if(c&&n[ops.dataFormat.checked]){c.addClass("checkbox_true_full_focus").removeClass("checkbox_false_full")}},reload:function(){this.$element.find(".fm-ulgtree").html("");this.loadData()}};a.fn.GridTree=function(e){var c=a(this);var d=c.data("GridTree");if(!d){c.data("GridTree",(d=new b(this,e)))}else{d.options=a.extend(false,c.GridTree.defaults,e)}return d};a.fn.GridTree.defaults={url:"",data:null,expand:-1,dataFormat:{child:"Child",checked:"Checked",selected:"Selected",icon:"Icon",open:"Open"},param:null,source:"Data",cache:true,treeModel:"default",multiple:false,selected:function(c){},checked:function(c){},afterLoad:null,beforeSelect:function(d,c){},beforeCheck:function(d,c){},bindNode:function(d,c){},unit:"%",header:null}})(window.jQuery);(function(a){a.fn.leftMenu=function(c){var b=a.extend(true,{url:"",data:null,model:"mini",box:"li"},c)}})(jQuery);
/*
 * jqueryui 模态窗口拓展类
 *创建人：qinnailin
 * 创建时间：2014/7/20 
 *
 *
 * 
 */
var basic_modal_content_count=0;(function(a){a.fn.modal=function(e){var d=a.extend(true,{title:"",url:null,modal:true,resizable:false,width:"auto",timeout:null,beforeClose:function(){if(d.modal==undefined||d.modal){if(!isparent){if(a(".ui-widget-overlay").size()<2){crossdomain("closebgmodel","")}}}},afterCreate:null,closeText:""},e);var c=a(this);var b=a(c).html();if(d.url){a.get(d.url,function(g){b=g;f()})}else{f()}function f(){if(a(c).is("script")){var h=a(c).attr("data-mun");if(!h){h=++basic_modal_content_count;a("body").append("<div id='basic-modal-content-"+h+"' class='basic-modal-content' style='display:none;overflow: visible;'></div>");a(c).attr("data-mun",h)}else{if(!document.getElementById("basic-modal-content-"+h)){a("body").append("<div id='basic-modal-content-"+h+"' class='basic-modal-content' style='display:none;overflow: visible;'></div>")}}c=a("#basic-modal-content-"+h)}a(c).html(b);try{a(c).dialog(d)}catch(g){alert("请引入jqueryui插件")}a(c).dialog({close:function(i,j){a(c).dialog("destroy");if(a(c).hasClass("basic-modal-content")){a(c).html("")}if(d.close){d.close()}}});if(d.modal){if(!isparent){crossdomain("showbgmodel","")}}if(d.timeout){setTimeout("closemodel("+num+")",d.timeout)}if(d.afterCreate){d.afterCreate()}a(c).find(".layout-center").each(function(j,k){findlayout(a(k))})}};a.fn.close=function(){if(a(this).is("script")){var b=a(this).attr("data-mun");if(!b){a(this).dialog("close");a(this).html("")}else{closemodel(b)}}else{a(this).dialog("close")}}})(jQuery);closemodel=function(a){$("#basic-modal-content-"+a).dialog("close");$("#basic-modal-content-"+a).html("")};function alertui(a){if(!document.getElementById("message-basic-modal-content")){$("body").append("<div id='message-basic-modal-content' style='display:none;overflow: visible;'></div>")}var c=true;if($(".ui-widget-overlay").get(0)){c=false}var b=$.extend(true,{modal:c,resizable:false,width:"250",clear:true,title:"提示!",beforeClose:function(){$("#message-basic-modal-content").html("").hide();if(!isparent){if(c){crossdomain("closebgmodel","")}}},buttons:[{text:"确定",click:function(){$("#message-basic-modal-content").dialog("close");if(!isparent){if(c){crossdomain("closebgmodel","")}}}}]},{});if(!isparent&&c){crossdomain("showbgmodel","")}$("#message-basic-modal-content").html("<div>"+a+"</div>");$("#message-basic-modal-content").dialog(b);return false}function confirmui(c,a,b){if(!document.getElementById("message-basic-modal-content")){$("body").append("<div id='message-basic-modal-content' style='display:none;overflow: visible;'></div>")}var e=true;if($(".ui-widget-overlay").get(0)){e=false}var d=$.extend(true,{modal:e,resizable:false,width:"350",clear:true,title:"提示!",beforeClose:function(){$("#message-basic-modal-content").html("").hide();if(!isparent){if(e){crossdomain("closebgmodel","")}}},buttons:[{text:"确定",click:function(){a();$("#message-basic-modal-content").dialog("close");if(!isparent){if(e){crossdomain("closebgmodel","")}}}},{text:"取消",click:function(){$("#message-basic-modal-content").dialog("close");if(!isparent){if(e){crossdomain("closebgmodel","")}}if(b){b()}}}]},{});if(!isparent&&e){crossdomain("showbgmodel","")}$("#message-basic-modal-content").html(c);$("#message-basic-modal-content").dialog(d);return false}loading=function(a){if(isparent){if(a==true){var b='<div class="alert fade in loading"><span></span>数据加载中……</div>';showmsghtml(b)}else{ClosemsgModal()}}else{crossdomain("loading",a)}};meddleloading=function(b,a){if($("#show-middle-modal-content").get(0)&&b){$("#show-middle-modal-content-msg").html(a)}else{if(isparent){if(b==true){var c='<div class="meddileloading" ><div></div><span id="show-middle-modal-content-msg" >'+(a?a:"数据加载中……")+"</span></div>";showMiddleModalHtml(c)}else{closeMiddleModal()}}else{crossdomain("meddleloading",b)}}};errormsg=function(a){if(isparent){var b='<div class="alert alert-error"><strong>提示！</strong>{{msg}}</div>';showmsghtml(b.replaceo("msg","<b style='color:red;'>"+a+"</b>"));setTimeout("ClosemsgModal()",2500)}else{crossdomain("errormsg",a)}};infomsg=function(a){if(isparent){var b='<div class="alert alert-info"><strong>提示！</strong>{{msg}}</div>';showmsghtml(b.replaceo("msg",a));setTimeout("ClosemsgModal()",2000)}else{crossdomain("infomsg",a)}};function ClosemsgModal(){$("#msgshow-modal-content").html("");$("#msgshow-modal-content").hide()}function showmsghtml(a){if(!document.getElementById("msgshow-modal-content")){$("body").append("<div id='msgshow-modal-content' style='width:200px;' ></div>")}if(!document.getElementById("styleshowmsghtml")){$("#styleshowmodal").remove();$("body").append("<style id='styleshowmsghtml' >#msgshow-modal-content{z-index: 9999;height:35px;display:none;}</style>")}$("#msgshow-modal-content").html(a);var d=document.documentElement.clientWidth;var c=document.documentElement.clientHeight;var b=$(document).scrollTop();$("#msgshow-modal-content").css({position:"absolute",top:b,left:(d-100)/2}).animate({top:b+5},500);$("#msgshow-modal-content").show()}function showMiddleModalHtml(a){if(!document.getElementById("show-middle-modal-content")){$("body").append("<div id='show-middle-modal-content' ></div>")}if(!document.getElementById("show-middle-modal-content-bg")){$("body").append("<div id='show-middle-modal-content-bg' ></div>")}if(!document.getElementById("styleshowMiddlehtml")){$("#styleshowMiddlehtml").remove();$("head").append("<style id='styleshowMiddlehtml' >#show-middle-modal-content{position:absolute;z-index: 9999;height:35px;display:none;}#show-middle-modal-content-bg{z-index: 9998;display:none;position: fixed;top: 0;left: 0;width: 100%;height: 100%;background: #666666  50% 50% repeat;opacity: .5;filter: Alpha(Opacity=50);}</style>")}$("#show-middle-modal-content").html(a);$("#show-middle-modal-content").show();$("#show-middle-modal-content-bg").show();var b=$("#show-middle-modal-content").height();var c=$("#show-middle-modal-content").children().width();var f=document.documentElement.clientWidth;var e=document.documentElement.clientHeight;var d=$(document).scrollTop();$("#show-middle-modal-content").css({top:((e-b)/2)+d,left:(f-c)/2})}function closeMiddleModal(){$("#show-middle-modal-content").html("").hide();$("#show-middle-modal-content-bg").hide()}
/*
 * selectbox控件
 * 创建人：qinnailin
 * 创建时间：2014/11/13 
 *
 *
 * 
 */
!(function(a){var c=function(d,e){this.init("selectbox",d,e)};var b=0;c.prototype={constructor:c,init:function(o,e,j){this.type=o;this.$element=a(e);this.options=this.getOptions(j);if(!a(e).hasClass("fmSelectbox")){a(e).addClass("fmSelectbox")}var p=a(e).width();var g=a(e).height();var h=a(e).attr("fm-name");var f=false;var k;var d=this;if(!a(e).children("select").get(0)){a(e).append("<select style='display:none;' name='"+h+"' ></select>");f=true;k=a(e).children("select")}else{k=a(e).children("select");if(!a(k).attr("name")){a(k).attr("name",a(e).attr("fm-name"))}a(k).hide()}this.selthis=k;if(a(e).children("ul").get(0)){a(k).empty();a(e).find("ul>li").each(function(q,r){var t=a(this).attr("val");var s=a(this).text();a(k).append("<option value='"+t+"' >"+s+"</option>")});a(e).children("ul").remove()}this.defaultval=this.options.defaults?this.options.defaults[1]:a(k).val();this.defaulttext=this.options.defaults?this.options.defaults[0]:a(k).children("option[value='"+this.defaultval+"']").text();a(e).append("<span style='height:"+g+"px;' >"+this.defaulttext+"<em></em></span>");var m=a(e).children("span");this.spanthis=m;a(e).append("<div style='width:"+(p-2)+"px;display:none;'><ul class='ul_sel'></ul></div>");var l=a(e).children("div");if(f){if(this.options.url==""&&this.options.data!=null){this.loadData()}else{if(this.options.url!=""){var i=this.options;a.getJSON(i.url,function(s){var q;if(i.source==""){q=s}else{var t=s;var r=i.source.split(".");a.each(r,function(u,v){if(v!=""){t=t[v]}});q=t}d.setData(q);d.loadData()})}}}a(m).click(function(q){if(a(e).hasClass("disabled")){return false}if(a(l).find("li").length>0){d.hideshowbox();q.stopPropagation()}else{d.showlist();q.stopPropagation()}});a(e).on("click","div>ul>li",function(){var r=a(this).attr("val");var q=a(this).text();d.setvalue(r,q);d.hideshowbox();if(d.options.change){d.options.change(a(k).val())}});a(document).click(function(){if(b<=0){d.hideshowbox()}});a(e).hover(function(){b++},function(){b--})},reqdata:function(){var d=this;var e=this.options;a.getJSON(e.url,function(h){var f;if(e.source==""){f=h}else{var i=h;var g=e.source.split(".");a.each(g,function(j,k){if(k!=""){i=i[k]}});f=i}d.setData(f);d.loadData()})},getOptions:function(d){return a.extend({},a.fn[this.type].defaults,d,this.$element.data())},loadData:function(){var e=this.options;if(e==undefined){return false}var d=this.selthis;if(this.options.defaults){d.append("<option value='"+this.options.defaults[1]+"' >"+this.options.defaults[0]+"</option>")}a.each(e.data,function(g,h){d.append("<option value='"+h[e.param.key]+"'>"+h[e.param.text]+"</option>")});if(this.defaultval!=a(this.selthis).val()){this.defaultval=a(this.selthis).val();this.defaulttext=a(this.selthis).children("option[value='"+this.defaultval+"']").text();this.spanthis.text(this.defaulttext).append("<em></em>")}if(this.options.initval){var f=a(this.selthis).children("option[value='"+this.options.initval+"']").text();this.setvalue(this.options.initval,f)}if(this.options.afterLoad){this.options.afterLoad()}},setvalue:function(e,d){a(this.selthis).children("option").siblings().removeAttr("selected");a(this.selthis).children("option[value="+e+"]").attr("selected","true");a(this.spanthis).text(d).append("<em></em>")},showlist:function(){var e=this.$element.children("div");a(".fmSelectbox>div").hide();a(e).children("ul").html("");a(this.selthis).children("option").each(function(f,g){if(a(g).val()!=a(this.selthis).val()){a(e).children("ul").append("<li val='"+a(g).val()+"' >"+a(g).text()+"</li>")}});var d=parseFloat(a(e).find("ul>li").eq(0).height());if(this.options.height>0){if(a(e).find("ul>li").size()*d>this.options.height){a(e).height(this.options.height);a(e).css("overflow-y","scroll")}}else{if(a(e).find("ul>li").size()<=10){a(e).height(a(e).find("ul>li").size()*d);a(e).css("overflow-y","hidden")}else{a(e).height(10*d);a(e).css("overflow-y","scroll")}}if(a(e).find("ul>li").size()>0){a(e).show()}},setData:function(d){this.options.data=d},hideshowbox:function(){var d=this.$element.children("div");a(d).hide();a(d).children("ul").empty();b=0},getVal:function(){return this.selthis.val()},getText:function(){return this.spanthis.text()},setSelected:function(d){var e=this.selthis.children("option[value='"+d+"']").text();this.setvalue(d,e)},clear:function(){var d=this.$element.children("div");a(d).children("ul").html("");this.selthis.html("");this.spanthis.text("").append("<em></em>");this.defaultval=""},reload:function(e){this.clear();if(e instanceof Object){this.options.data=e;this.loadData();var g=this.selthis.val();if(this.options.change){this.options.change(g)}}else{var f=this.options;var d=this;a.getJSON(e,function(j){var h;if(f.source==""){h=j}else{var k=j;var i=f.source.split(".");a.each(i,function(m,o){if(o!=""){k=k[o]}});h=k}d.setData(h);d.loadData();var l=d.selthis.val();if(f.change){f.change(l)}})}}};a.fn.selectbox=function(f){var d=a(this);var e=d.data("selectbox");if(!e){d.data("selectbox",(e=new c(this,f)))}else{e.options=a.extend(false,d.selectbox.defaults,f);e.clear();if(e.options.data!=null){e.loadData()}else{e.reqdata()}}return e};a.fn.selectbox.defaults={url:"",data:null,source:"",defaults:["--请选择--",-1],param:{key:"id",text:"name"},height:0,change:null,initval:null,afterLoad:null}})(window.jQuery);
/*
 * splitter
 * 创建人：qinnailin
 * 创建时间：2015/1/21
 */
!(function(a){var e=function(){this.init()};var c=false,b,d=true;e.prototype={constructor:e,init:function(){var f=this;a(".splitter").each(function(g,h){f.splitter(h)});a(".splitter").on("mousedown",".layout-splitter",function(g){b=a(this);c=true;if(a(this).width()>4){d=false}else{d=true}document.onselectstart=new Function("event.returnValue=false")});a(document).mouseup(function(g){c=false;b=null;document.onselectstart=new Function("event.returnValue=true")});a(document).mousemove(function(g){if(c&&d){var h=f.mouseCoords(g);f.checkWidth(b,h)}else{if(c){var h=f.mouseCoords(g);f.checkHeight(b,h)}}})},splitter:function(p){var f=a(p),A=f.width()-getwborder(f),q=f.height()-getontborder(f),t=f.children(".layout-left"),x=f.children(".layout-right"),y=f.children(".layout-up"),m=f.children(".layout-down"),k=t.width(),o=y.height(),j=m.height(),s=k>0?k:A*0.2,v=k>0?(A-s-4):A*0.8-4,z=(o>0||j>0)?(o>0?o:(q-j-4)):q*0.5-2,i=(o>0||j>0)?(j>5?j:(q-z-4)):q*0.5-2,g=a("<div></div>");i=q>z+i+4?q-z-4:i;g.addClass("layout-splitter");if(t.get(0)&&x.get(0)){g.css("width","4px").css("cursor","col-resize").css("height","100%").css("float","left");g.addClass("splitter-L");t.after(g);t.css("width",s).css("height","100%").css("float","left");x.css("width",v).css("height","100%").css("float","left")}else{if(y.get(0)&&m.get(0)){g.css("width","100%").css("cursor","row-resize").css("height","4px");g.addClass("splitter-H");y.after(g);y.css("height",z);m.css("height",i)}}},checkWidth:function(g,k){var f=g.parent(".splitter"),p=f.width()-getwborder(f),i=f.children(".layout-left"),o=f.children(".layout-right"),j=this.getPosition(i).left,q=k.x-j,q=q<50?50:q,h=q-4,h=h>p-50?p-50:h,m=p-h-4;i.width(h);o.width(m)},checkHeight:function(i,o){var f=i.parent(".splitter"),j=f.height(),q=f.children(".layout-up"),g=f.children(".layout-down"),m=this.getPosition(q).top,s=o.y-m,s=s<5?5:s,k=s-4,k=k>j-5?j-5:k,p=j-k-4;q.height(k);g.height(p)},getPosition:function(f){return a.extend({},f.offset(),{width:f[0].offsetWidth,height:f[0].offsetHeight})},mouseCoords:function(f){if(f.pageX||f.pageY){return{x:f.pageX,y:f.pageY}}return{x:f.clientX+document.body.scrollLeft-document.body.clientLeft,y:f.clientY+document.body.scrollTop-document.body.clientTop}}};a(document).ready(function(){var f=new e()})})(jQuery);
/*
 * utab
 * 创建人：qinnailin
 * 创建时间：2014/11/18
 *
 *
 * 
 */
(function(a){a.fn.utab=function(d){var c=a.extend(true,{},d);var b=a(this);a(document).ready(function(){a(b).find(".tab-content>div:first").addClass("tab-pane").addClass("active").siblings("div").addClass("tab-pane");a('<ul class="nav nav-tabs"></ul>').insertBefore(a(b).find(".tab-content"));a(b).find(".tab-pane").each(function(e,f){var h="tab-div-box-fm-"+e;a(f).attr("data-tag",h);var g=a(f).attr("data-name");a(b).find("ul.nav-tabs").append("<li><a href='javascript:' data-tag='"+h+"' >"+g+"</a></li>")});a(b).find("ul>li:first").addClass("active");a(b).find("ul.nav-tabs").on("click","li>a",function(){var e=a(b).find("ul.nav-tabs>li").index(a(this).parent("li"));a(this).parent("li").addClass("active").siblings("li").removeClass("active");a(b).find(".tab-content>div").eq(e).addClass("active").siblings("div").removeClass("active")})})}})(jQuery);(function(a){a.fn.extend({time:function(d){var c=a.extend(true,{format:"HH:mm:ss",minTime:null,maxTime:null,zindex:500,onclose:null},d);var b=a(this);var e;var f={hour:0,minute:0,second:0};var g={getPosition:function(h){return a.extend({},(h?{top:0,left:0}:a(b).offset()),{width:b[0].offsetWidth,height:b[0].offsetHeight})},create:function(){var k=this.getPosition();var i,j,l;if(a(b).val()==""){var h=new Date();f.hour=i=h.getHours();f.minute=j=h.getMinutes();f.second=l=h.getSeconds()}else{var p=a(b).val();var o=p.split(":");f.hour=i=o[0];if(o.length>=2){f.minute=j=o[1]}if(o.length>=3){f.second=l=o[2]}}var m="<div  class='timepicker time-picker-wrap' style='display: block; z-index:"+c.zindex+"'><table><tbody><tr class='time-board-wrap'><td class='hour-picker-wrap'><div class='scoreboard'><div class='increase-button'><span></span></div><div class='score'><span>"+i+"</span></div><div class='decrease-button'><span></span></div></div></td><td>:</td><td class='minute-picker-wrap'><div class='scoreboard'><div class='increase-button'><span></span></div><div class='score'><span>"+j+"</span></div><div class='decrease-button'><span></span></div></div></td><td>:</td><td class='second-picker-wrap'><div class='scoreboard'><div class='increase-button'><span></span></div><div class='score'><span>"+l+"</span></div><div class='decrease-button'><span></span></div></div></td></tr><tr class='button-wrap'><td class='clear-wrap' colspan='2'><span>清除</span></td><td></td><td class='close-wrap' colspan='2'><span>关闭</span></td></tr></tbody></table></div>";a(b).after(m);e=a(b).next(".timepicker");a(e).css({top:(k.top+k.height),left:k.left});a(e).on("click",".close-wrap",function(){if(f.hour!=0||f.minute!=0||f.second!=0){a(b).val(f.hour+":"+f.minute+":"+f.second)}if(c.onclose){c.onclose(f)}g.hide()});a(e).on("click",".clear-wrap",function(){a(b).val("");g.hide()});a(e).on("click",".hour-picker-wrap .increase-button",function(){var r=a(this).next(".score").children("span").text();var q=(parseInt(r)+1);if(q>23){q=0}f.hour=q;a(this).next(".score").children("span").text(q)});a(e).on("click",".hour-picker-wrap .decrease-button",function(){var r=a(this).prev(".score").children("span").text();var q=(parseInt(r)-1);if(q<0){q=23}f.hour=q;a(this).prev(".score").children("span").text(q)});a(e).on("click",".minute-picker-wrap .increase-button",function(){var q=a(this).next(".score").children("span").text();var r=(parseInt(q)+1);if(r>59){r=0}f.minute=r;a(this).next(".score").children("span").text(r)});a(e).on("click",".minute-picker-wrap .decrease-button",function(){var q=a(this).prev(".score").children("span").text();var r=(parseInt(q)-1);if(r<0){r=59}f.minute=r;a(this).prev(".score").children("span").text(r)});a(e).on("click",".second-picker-wrap .increase-button",function(){var q=a(this).next(".score").children("span").text();var r=(parseInt(q)+1);if(r>59){r=0}f.second=r;a(this).next(".score").children("span").text(r)});a(e).on("click",".second-picker-wrap .decrease-button",function(){var q=a(this).prev(".score").children("span").text();var r=(parseInt(q)-1);if(r<0){r=59}f.second=r;a(this).prev(".score").children("span").text(r)});a(window).click(function(q){if(q.srcElement!=a(b).get(0)&&a(q.srcElement).parents(".timepicker").get(0)!=a(e).get(0)){g.hide()}})},show:function(){if(a(b).val()==""){var h=new Date();f.hour=h.getHours();f.minute=h.getMinutes();f.second=h.getSeconds()}else{var k=a(b).val();var j=k.split(":");f.hour=j[0];if(j.length>=2){f.minute=j[1]}if(j.length>=3){f.second=j[2]}}a(e).find(".hour-picker-wrap .score>span").eq(0).text(f.hour);a(e).find(".minute-picker-wrap .score>span").eq(0).text(f.minute);a(e).find(".second-picker-wrap .score>span").eq(0).text(f.second);var i=this.getPosition();a(e).css({top:(i.top+i.height),left:i.left});a(e).show()},hide:function(){a(e).hide()}};a(b).focus(function(){if(a(e).get(0)){g.show();var i=a(b).val();if(i!=""){var h=i.split(":");hour=h[0];if(h.length>=2){minute=h[1]}if(h.length>=3){second=h[2]}}}else{g.create()}});a(b).keyup(function(){a(b).val("")})}})})(jQuery);
/*
 * Tooltip 仿bootstrap-tooltip
 * 创建人：qinnailin
 * 创建时间：2014/11/18
 *
 *
 * 
 */
!(function(a){var b=function(c,d){this.init("Tooltip",c,d)};b.prototype={constructor:b,init:function(g,c,f){this.type=g;this.$element=a(c);this.options=this.getOptions(f);this.setContent();var d=this.options.trigger=="hover"?"mouseenter":"focus";var e=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(d,a.proxy(this.enter,this));this.$element.on(e,a.proxy(this.leave,this))},enter:function(c){var d=a(c.currentTarget)[this.type](this.options).data(this.type);d.show()},leave:function(c){var d=a(c.currentTarget)[this.type](this.options).data(this.type);d.hide()},getOptions:function(c){c=a.extend({},a.fn[this.type].defaults,c,this.$element.data());return c},show:function(){var c,g,i,f=this.options.placement,e,d;c=this.tip();c.remove().css({top:0,left:0,display:"block"}).appendTo(document.body);var h=this.getTitle();if(h==""){return false}c.find(".tooltip-inner").html(h);g=this.getPosition();e=c[0].offsetWidth;d=c[0].offsetHeight;switch(f){case"top":i={top:g.top-d,left:g.left+g.width/2-e/2};break;case"left":i={top:g.top-d/2+g.height/2,left:g.left-e};break;case"right":i={top:g.top-d/2+g.height/2,left:g.left+g.width};break;case"bottom":i={top:g.top+g.height,left:g.left+g.width/2-e/2};break;default:}c.addClass("fade").addClass(f).addClass("in").css(i)},hide:function(){a(".tooltip").remove()},getPosition:function(){return a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},setContent:function(){var c=this.$element;c.attr("data-title",c.attr("title")).removeAttr("title")},tip:function(){return a(this.options.template)},getTitle:function(){var c=this.$element;return c.attr("data-title")}};a.fn.Tooltip=function(c){return this.each(function(){var d=a(this);var e=d.data("Tooltip");if(!e){d.data("Tooltip",(e=new b(this,c)))}if(typeof c=="string"&&c!=""){e.options.placement=c}})};a.fn.Tooltip.defaults={placement:"top",trigger:"hover",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}})(window.jQuery);
/*
 * 树控件
 * 创建人：qinnailin
 * 创建时间：2014/7/9 
 */
(function(a){a.fn.Tree=function(m){var l=a.extend(true,{url:null,data:null,treeModel:"default",multiple:false,key:"Id",text:"Name",child:"Child",expand:false,clazz:0,source:"",onlyleaf:false,selected:function(s){},afterLoad:null},m);var k=a(this);var j=l.expand?"open":"close";var o;var b=0;var i='<li {{selected}} ><span class="button switch {{icon1}}" ></span>';if(l.treeModel=="checkbox"){i+='<span  class="button chk checkbox_false_full" ></span>'}i+='<a  data-id="{{'+l.key+'}}" ><span {{diyicon}} class="button {{icon2}}"></span><span >{{'+l.text+"}}</span></a>{{child}}</li>";if(l.url==null&&l.data!=null){a(k).html(e());q();r();if(l.afterLoad){l.afterLoad()}}else{h()}a(document).ready(function(){if(l.treeModel=="default"){a(k).on("click","a",function(){var u=a(this);var s=a(u).attr("data-id");var t=a(u).find(".ico_docu").get(0);if(l.onlyleaf&&t==undefined){return false}if(!l.multiple){a(k).find("a").removeClass("curSelectedNode")}if(a(u).hasClass("curSelectedNode")){a(u).removeClass("curSelectedNode")}else{a(u).addClass("curSelectedNode")}var v=a(u).parent("li").parent("ul").prev("a").attr("data-id");if(s){o={key:s,pid:v?v:0};l.selected(o)}})}a(k).on("click","span.switch",function(){var u=a(this);var t=a(u);if(t.attr("class").search("_close")>0){var s=g(t,"close");a(u).removeClass(s).addClass(s.replace("_close","_open"))}else{if(t.attr("class").search("_open")>0){var s=g(t,"open");a(u).removeClass(s).addClass(s.replace("_open","_close"))}}t=a(u).siblings("a").children("span");if(t.attr("class").search("_close")>0){var s=g(t,"close");a(u).siblings("a").children("span").removeClass(s).addClass(s.replace("_close","_open"))}else{if(t.attr("class").search("_open")>0){var s=g(t,"open");a(u).siblings("a").children("span").removeClass(s).addClass(s.replace("_open","_close"))}}a(u).parent("li").find("ul").each(function(v,w){if(a(this).prevAll("span.switch").attr("class").search("_open")>0){a(this).show()}else{a(this).hide()}})});a(k).on("click","span.chk",function(){var w=a(this);var v=a(w).siblings("ul").get(0);if(v&&!l.multiple){return}if(!l.multiple){if(a(w).hasClass("checkbox_true_full_focus")){a(k).find(".chk").removeClass("checkbox_true_full_focus").addClass("checkbox_false_full")}else{a(k).find(".chk").removeClass("checkbox_true_full_focus").addClass("checkbox_false_full");a(w).removeClass("checkbox_false_full").addClass("checkbox_true_full_focus");var u=a(w).next("a").attr("data-id");var y=a(w).parent("li").parent("ul").prev("a").attr("data-id");if(u){o={key:u,pid:y?y:0};l.selected(o)}}}else{if(a(w).hasClass("checkbox_false_full")){a(w).removeClass("checkbox_false_full").addClass("checkbox_true_full_focus");a(w).siblings("ul").find(".chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus");var u=a(w).next("a").attr("data-id");var y=a(w).parent("li").parent("ul").prev("a").attr("data-id");if(u){o={key:u,pid:y?y:0};l.selected(o)}}else{a(w).removeClass("checkbox_true_full_focus").addClass("checkbox_false_full");var x=a(w).parent("li").parent("ul");var t=a(x).find(".checkbox_true_full_focus").size();a(w).parent("li").parents("ul").siblings(".chk").removeClass("checkbox_true_full_focus").addClass("checkbox_false_full");var s=a(w).siblings("ul").find(".chk").removeClass("checkbox_true_full_focus").addClass("checkbox_false_full")}p(a(w))}})});function h(){a.getJSON(l.url,function(u){var s;if(l.source==""){s=u}else{var v=u;var t=l.source.split(".");a.each(t,function(w,x){if(x!=""){v=v[x]}});s=v}l.data=s;a(k).html(e());q();r();if(l.afterLoad){l.afterLoad()}})}function g(u,w){var s=u.attr("class").split(" ");var v;for(var t in s){if(w=="close"){v=s[t].match(/(.+?_close)/g)}else{v=s[t].match(/(.+?_open)/g)}if(v){break}}return v+""}function q(){if(j=="close"){a(k).find(".fm-tree ul").hide()}else{a(k).find(".fm-tree ul").show();if(l.clazz>0){a(k).find("span.ico_close").parent("a").siblings("ul").hide()}}}function r(){a(k).find("li.selected").each(function(s,t){if(l.treeModel=="default"){if(a(t).children("ul").size()==0){a(t).children("a").addClass("curSelectedNode");a(t).parents("ul").show();a(t).parents("ul").siblings("span.switch").each(function(v,w){var u=g(a(w),"close");a(w).removeClass(u).addClass(u.replace("_close","_open"))});a(t).parents("ul").siblings("a").each(function(v,w){var u=g(a(w).children("span"),"close");a(w).children("span").removeClass(u).addClass(u.replace("_close","_open"))})}}else{if(l.treeModel=="checkbox"){if(a(t).children("ul").size()==0){a(t).children("span.chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus")}else{a(t).find("span.chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus")}a(t).parents("ul").show();a(t).find("ul").show();a(t).parents("ul").siblings("span.switch").each(function(v,w){var u=g(a(w),"close");a(w).removeClass(u).addClass(u.replace("_close","_open"))});a(t).find("ul").siblings("span.switch").each(function(v,w){var u=g(a(w),"close");a(w).removeClass(u).addClass(u.replace("_close","_open"))});a(t).parents("ul").siblings("a").each(function(v,w){var u=g(a(w).children("span"),"close");a(w).children("span").removeClass(u).addClass(u.replace("_close","_open"))});a(t).find("ul").siblings("a").each(function(v,w){var u=g(a(w).children("span"),"close");a(w).children("span").removeClass(u).addClass(u.replace("_close","_open"))})}}})}function e(){var s='<ul class="unstyled fm-tree">';a.each(l.data,function(u,v){var t="roots_"+j;if(u>0&&u<l.data.length-1){t="center_"+j}else{if(u>0){t="bottom_"+j}}b=0;s+=d(v,t,"ico_"+j,l.data.length-1==u)});s+="</ul>";return s}function d(t,u,v,w){if(t){var s=false;if(l.clazz>0&&l.expand&&l.clazz-1<=b++){s=true}return i.replaceo("child",c(t[l.child],w,s)).replaceo(l.key,t[l.key]).replaceo(l.text,t[l.text]).replaceo("icon1",u).replaceo("diyicon",(t.Icon&&t.Icon!="")?'style="background: url('+t.Icon+') 0 0 no-repeat;"':"").replaceo("selected",t.Selected?'class="selected"':"").replaceo("icon2",v)}else{return""}}function c(t,v,s){if(t&&t.length>0){var u="<ul ";u+=v?">":'class="line" >';a.each(t,function(w,z){var y="ico_"+(s?"close":j);var x=t.length-1==w?"bottom_"+(s?"close":j):"center_"+(s?"close":j);if(!z[l.child]||z[l.child].length==0){y="ico_docu";x=t.length-1==w?"bottom_docu":"center_docu"}u+=d(z,x,y,t.length-1==w)});u+="</ul>";return u}else{return""}}var f={remove:function(t,s){},getSelected:function(){o=new Array();if(l.treeModel=="default"){var s=a(k).find("a.curSelectedNode");a.each(s,function(t,v){var u=a(v).attr("data-id");var w=a(v).parent("li").parent("ul").prev("a").attr("data-id");if(u){o.push({key:u,pid:w?w:0,text:a(v).parent("li").children("a").text()})}})}else{if(l.treeModel=="checkbox"){var s=a(k).find("span.checkbox_true_full_focus");a.each(s,function(t,v){var u=a(v).next("a").attr("data-id");var w=a(v).parent("li").parent("ul").prev("a").attr("data-id");if(u){o.push({key:u,pid:w?w:0,text:a(v).parent("li").children("a").text()})}})}}return o},reload:function(){h()},refresh:function(){a(k).html(e());q()},setSelected:function(s){if(l.multiple){if(s instanceof Object){a.each(s,function(v,w){var x=a(k).find("[data-id="+w+"]").eq(0);if(a(x).get(0)){a(x).siblings(".chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus")}if(a(x).nextAll("ul").get(0)){a(x).nextAll("ul").find(".chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus")}p(a(x).siblings(".chk"))})}else{var u=s.split(",");a.each(u,function(v,w){var x=a(k).find("[data-id="+w+"]").eq(0);if(a(x).get(0)){a(x).siblings(".chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus");if(l.treeModel!="checkbox"){a(x).addClass("curSelectedNode")}}if(a(x).nextAll("ul").get(0)){a(x).nextAll("ul").find(".chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus")}p(a(x).siblings(".chk"))})}}else{var t=a(k).find("[data-id="+s+"]").eq(0);if(l.treeModel!="checkbox"){a(t).addClass("curSelectedNode")}if(!a(t).nextAll("ul").get(0)){a(t).siblings(".chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus")}}},getData:function(){return l.data},donSelect:function(s){if(l.treeModel=="checkbox"){a(k).find("a[data-id="+s+"]").prev("span.chk").removeClass("checkbox_true_full_focus").addClass("checkbox_false_full")}else{a(k).find("a[data-id="+s+"]").removeClass("curSelectedNode")}}};function p(s){var t=a(s).parent("li").parent("ul");if(a(t).get(0)){var u=a(t).find(".checkbox_false_full").size();if(u==0){a(t).siblings(".chk").removeClass("checkbox_false_full").addClass("checkbox_true_full_focus")}p(a(t).siblings(".chk"))}}return f}})(jQuery);
/*
 * 集成表格控件 
 *创建人：qinnailin
 * 创建时间：2014/11/11 尼玛个光棍节！！
 */
(function(a){a.fn.uTable=function(f){var e=a.extend(true,{url:"",data:null,dataformat:{data:"Data",count:"Count"},click:null,dbclick:null,method:"Get",dataType:"json",sortMultiple:true,putJson:true,cache:true,multiple:true,cancel:true,page:{enable:true,click:null,pageSize:30,pageIndex:1,back:"上一页",next:"下一页",reqindex:"pageindex",reqsize:"pagesize"},afterLoad:null,checkbox:{enable:false},buttons:null,heads:[]},f);var d=a(this);a(d).addClass("container-fluid");a(d).addClass("layout-box");c();b();a(d).find(".layout-center").each(function(j,k){findlayout(a(k))});function c(){if(!e.buttons){return false}if(!a(d).find(".utable-tool").get(0)){var j="<div class=\"row-fluid layout-top utable-tool\" style='height:50px;' ></div>";a(d).append(j);a.each(e.buttons,function(k,l){a("<button class='btn UTable-btn2 "+(l.style?l.style:"")+"' >"+l.text+"</button>").appendTo(a(d).find(".utable-tool")).click(function(){l.click()})})}}function b(){var j='<div class="row-fluid layout-center"><div class="layout-box">';j+='<div class="row-fluid layout-top table_th '+(e.buttons?"utable-hasbutton":"")+"\" style='height:30px; background:#f7f7f7; padding-right:17px;' >";j+="<table class='table' ><thead fm-head><tr>";if(e.checkbox.enable&&e.multiple){j+="<th ><input type='checkbox' class='chkAll' /></th>"}else{if(e.checkbox.enable){j+="<th ></th>"}}a.each(e.heads,function(k,l){j+=(l.sort?"<th fm-sort='"+l.key+"' "+(l.width?"width='"+l.width+"'":"")+" >":"<th "+(l.width?"width='"+l.width+"'":"")+">")+l.name+"</th>"});j+="</tr></thead></table>";j+="</div><div class=\"row-fluid layout-center\" style='overflow-y:scroll'>";j+="<table class='table scroll_table table_hover table_ch_c'  ><tbody fm-body><tr>";if(e.checkbox.enable){j+="<td ><input type='checkbox' /></td>"}a.each(e.heads,function(k,l){j+="<td "+(l.conver?"fm-conver='"+l.conver+"'":"")+" "+(l.width?"width='"+l.width+"'":"")+" >{{"+l.key+"}}</td>"});j+="</tr></tbody></table>";j+="</div>";if(e.page.enable){j+='<div class="row-fluid layout-bottom" style=\'height:35px;\' ><div fm-pagerbox class="tfoot"></div></div>'}j+="</div></div>";a(d).append(j)}if(e.page.click){var h=e.page.click;e.page.click=function(){a(d).find(".chkAll").removeAttr("checked");h()}}else{e.page.click=function(){a(d).find(".chkAll").removeAttr("checked")}}a(document).ready(function(){a(d).find("[fm-body]").on("click","tr",function(){var j=a(this);if(j.hasClass("checked_tr")){if(e.cancel){a(j).removeClass("checked_tr");a(j).find("input[type='checkbox']").removeAttr("checked");a(d).find(".chkAll").removeAttr("checked")}}else{if(!e.multiple){a(d).find("[fm-body] input[type='checkbox']").removeAttr("checked");a(d).find("[fm-body]>tr").removeClass("checked_tr")}a(j).addClass("checked_tr");a(j).find("input[type='checkbox']").attr("checked","checked");if(a(d).find("[fm-body] input:checked").size()==a(d).find("[fm-body]>tr").size()){if(e.multiple){a(d).find(".chkAll").attr("checked","checked")}}}});a(d).on("click",".chkAll",function(){if(a(this).attr("checked")=="checked"){a(d).find("[fm-body] input[type='checkbox']").attr("checked","checked");a(d).find("[fm-body]>tr").addClass("checked_tr")}else{a(d).find("[fm-body] input[type='checkbox']").removeAttr("checked").removeClass("checked_tr");a(d).find("[fm-body]>tr").removeClass("checked_tr")}})});var i=a(d).Grid(e);var g={utable:i,getSelectData:function(){var j=new Array();var k=i.getData();a(d).find("[fm-body]>tr.checked_tr").each(function(l,m){j.push(a(m).data("jsondata"))});return j},refresh:function(){i.refresh()},reload:function(){i.reload()},load:function(j){i.load(j)}};return g}})(jQuery);
/*
 * 树控件
 * 创建人：qinnailin
 * 创建时间：2014/10/17
 */
(function(a){a.fn.uTree=function(g){var i=a.extend(true,{treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:false,showTitle:true,txtSelectedEnable:false,expand:-1},check:{enable:false,chkStyle:"checkbox",chkboxType:{Y:"ps",N:"ps"}},data:{key:{children:"Child",name:"Name",title:"",url:"url"},simpleData:{enable:false,idKey:"Id",pIdKey:"PId",rootPId:null},keep:{parent:false,leaf:false},Nodes:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null,afterLoad:null}},g);var d=a(this);var j=a(d).attr("id");if(!d.hasClass("ztree")){d.addClass("ztree")}var l;try{if(i.view.expand!=-1){var f;if(i.callback.onNodeCreated!=null){f=i.callback.onNodeCreated}i.callback.onNodeCreated=function(m,o,p){var q=a.fn.zTree.getZTreeObj(j);if(p.level<=i.view.expand){q.expandNode(p,null,null,null,true)}if(f){f(m,o,p)}}}var k=i.callback.onAsyncSuccess;i.callback.onAsyncSuccess=function(e,p,q,m){if(k){k(e,p,q,m)}if(i.callback.afterLoad){i.callback.afterLoad()}var o=[];if(i.check.enable){o=l.getCheckedNodes(true)}else{o=l.getSelectedNodes()}a.each(o,function(r,s){c(s)})};l=a.fn.zTree.init(d,i,i.data.Nodes);if(i.async==undefined||!i.async.enable){if(i.callback.afterLoad){i.callback.afterLoad()}var h=[];if(i.check.enable){h=l.getCheckedNodes(true)}else{h=l.getSelectedNodes()}a.each(h,function(e,m){c(m)})}}catch(b){alertui("请引入zTree类库!");console.debug(b)}a.extend(true,l,{setSelected:function(p){var o=l.transformToArray(l.getNodes());var q=p.split(",");for(var e=0;e<q.length;e++){for(var m=0;m<o.length;m++){if(o[m][i.data.simpleData.idKey]==q[e]){if(i.check.enable){l.checkNode(o[m],true,true)}else{l.selectNode(o[m],i.view.selectedMulti)}break}}}var r=[];if(i.check.enable){r=l.getCheckedNodes(true)}else{r=l.getSelectedNodes()}a.each(r,function(s,t){c(t)})},donSelect:function(m){if(i.check.enable){var o=l.getCheckedNodes(true);for(var e=0;e<o.length;e++){if(o[e][i.data.simpleData.idKey]==m){l.checkNode(o[e],false,true);break}}}else{var o=l.getSelectedNodes();for(var e=0;e<o.length;e++){if(o[e][i.data.simpleData.idKey]==m){l.cancelSelectedNode(o[e]);break}}}}});function c(e){l.expandNode(e,true,false,false,false);var m=e.getParentNode();if(m){c(m)}}return l}})(jQuery);!(function(a){var b=function(c){this.init(c)};b.prototype={ws:null,init:function(d){var c;this.opstions=c=this.getOpstions(d);if(this.checkBrowser()){this.ws=this.openWS(c.callback,c.error,c.close)}else{this.doAjaxRequest(c.callback,c.error)}},getOpstions:function(c){return a.extend(true,a.webcnm.defaults,c)},doAjaxRequest:function(d,e){var f=this.opstions,c;c=this;a.ajax({type:f.type,url:f.url,dataType:f.dataType,timeout:f.timeout,data:{webComet:true,tim:Math.random()},success:function(g,h){c.doAjaxRequest(d,e)},complete:function(h,g){if(h.readyState=="4"){d(h.responseText)}},error:function(i,h,g){if(h=="timeout"){c.doAjaxRequest(d,e)}else{e("error:"+h)}}})},checkBrowser:function(){if(window.WebSocket){return true}else{return false}},openWS:function(c,e,d){var f;f=new WebSocket(this.opstions.ws);f.onopen=function(){console.info("服务器链接成功！")};f.onmessage=function(g){c(g.data)};f.onerror=function(g){console.info(g.error);if(e){e(g)}};f.onclose=function(){console.info("服务关闭！");if(d){d()}};return f},send:function(d){if(this.ws){this.ws.send(d)}else{var e=this.opstions,c;c=this;a.ajax({type:e.type,url:e.url,dataType:e.dataType,data:d,success:function(f,g){},complete:function(g,f){e.callback(g.responseText)},error:function(h,g,f){e.error("error:"+g)}})}}};a.webcnm=function(d){var c=a("body").data("websocket");if(!c){a("body").data("websocket",c=new b(d))}return c};a.webcnm.defaults={ws:null,type:"post",url:"",dataType:"json",timeout:10000,callback:function(){},error:function(){},close:function(){}}})(jQuery);